<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>FitnessPro</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a202c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FitnessPro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="FitnessPro">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💪</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💪</text></svg>">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Профессиональное фитнес приложение для тренировок с системой достижений и аналитикой">
    <meta name="keywords" content="фитнес, тренировки, спорт, gym, workout, achievements">
    <meta name="author" content="FitnessPro">
    
</head>
    <style>
        :root {
            --primary: #007AFF;
            --primary-dark: #0056CC;
            --primary-gradient: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            --primary-glow: 0 0 20px rgba(0, 122, 255, 0.3);
            --secondary: #5856D6;
            --success: #30D158;
            --success-gradient: linear-gradient(135deg, #30D158 0%, #00C7BE 100%);
            --warning: #FF9F0A;
            --warning-gradient: linear-gradient(135deg, #FF9F0A 0%, #FFD60A 100%);
            --error: #FF453A;
            --error-gradient: linear-gradient(135deg, #FF453A 0%, #FF6B35 100%);
            --background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            --surface: rgba(28, 28, 30, 0.8);
            --surface-elevated: rgba(44, 44, 46, 0.9);
            --surface-light: rgba(58, 58, 60, 0.6);
            --surface-gradient: linear-gradient(135deg, rgba(28, 28, 30, 0.8) 0%, rgba(44, 44, 46, 0.6) 100%);
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --text-tertiary: #636366;
            --border: rgba(255, 255, 255, 0.1);
            --border-light: rgba(255, 255, 255, 0.05);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-soft: 0 4px 16px rgba(0, 0, 0, 0.2);
            --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-large: 0 16px 64px rgba(0, 0, 0, 0.5);
            --backdrop-blur: blur(20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.4;
            -webkit-font-smoothing: antialiased;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            overflow-x: hidden;
        }

        .app {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .app::before {
            content: '';
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 428px;
            height: 100vh;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 122, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(88, 86, 214, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(48, 209, 88, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Header */
        .header {
            position: sticky;
            top: env(safe-area-inset-top);
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: var(--backdrop-blur);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            box-shadow: var(--shadow-soft);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-title {
            font-size: 22px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: var(--primary-glow);
        }

        .user-info {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 6px 12px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            backdrop-filter: var(--backdrop-blur);
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 0 20px 100px;
        }

        /* Current Session */
        .session-card {
            background: var(--primary-gradient);
            border-radius: 20px;
            padding: 28px;
            margin: 24px 0;
            color: white;
            box-shadow: var(--shadow-large);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .session-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .session-date {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 500;
        }

        .session-type {
            background: rgba(255, 255, 255, 0.25);
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .session-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .session-duration {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 16px;
            border-radius: 16px;
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            display: block;
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            font-weight: 500;
        }

        /* Exercise List */
        .exercise-section {
            margin: 32px 0;
        }

        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--text-primary);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exercise-list {
            background: var(--surface-gradient);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border);
            backdrop-filter: var(--backdrop-blur);
            box-shadow: var(--shadow-medium);
        }

        .exercise-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-light);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .exercise-actions {
            display: flex;
            align-items: center;
            margin-left: auto;
        }

        .exercise-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: all 0.3s ease;
        }

        .exercise-item:last-child {
            border-bottom: none;
        }

        .exercise-item.completed {
            background: var(--success-gradient);
            color: white;
        }

        .exercise-item.completed::before {
            background: var(--success);
            box-shadow: 0 0 10px rgba(48, 209, 88, 0.5);
        }

        .exercise-item.active {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .exercise-item.active::before {
            background: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .exercise-item:hover:not(.completed):not(.active) {
            background: var(--surface-elevated);
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .exercise-number {
            width: 36px;
            height: 36px;
            background: var(--surface-light);
            color: var(--text-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            margin-right: 16px;
            flex-shrink: 0;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .exercise-item.completed .exercise-number {
            background: white;
            color: var(--success);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-soft);
        }

        .exercise-item.active .exercise-number {
            background: white;
            color: var(--primary);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-soft);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .exercise-details {
            flex: 1;
        }

        .exercise-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 6px;
            color: inherit;
        }

        .exercise-sets {
            font-size: 14px;
            color: inherit;
            opacity: 0.8;
            font-weight: 500;
        }

        .exercise-status {
            font-size: 12px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 12px;
            margin-left: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: inherit;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: var(--backdrop-blur);
        }

        /* Timer Section */
        .timer-section {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 388px;
            background: var(--surface-gradient);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 24px;
            backdrop-filter: var(--backdrop-blur);
            box-shadow: var(--shadow-large);
            display: none;
            z-index: 50;
        }

        .timer-section.active {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .timer-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-time {
            font-size: 40px;
            font-weight: 900;
            font-family: 'SF Mono', Monaco, monospace;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            text-shadow: var(--primary-glow);
        }

        .timer-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .timer-btn {
            width: 52px;
            height: 52px;
            border: none;
            border-radius: 50%;
            background: var(--glass);
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--backdrop-blur);
        }

        .timer-btn:hover {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.1);
            box-shadow: var(--shadow-medium);
        }

        .timer-btn.primary {
            background: var(--primary-gradient);
            color: white;
            width: 72px;
            height: 72px;
            font-size: 28px;
            box-shadow: var(--shadow-medium);
        }

        .timer-btn.primary:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-large);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin: 28px 0;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-medium);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-large);
        }

        .btn-secondary {
            background: var(--surface-gradient);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--backdrop-blur);
        }

        .btn-secondary:hover {
            background: var(--surface-elevated);
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 428px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: var(--backdrop-blur);
            border-top: 1px solid var(--glass-border);
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 16px;
            position: relative;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item.active::before,
        .nav-item:hover::before {
            opacity: 0.1;
        }

        .nav-item.active {
            color: var(--primary);
            transform: scale(1.05);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--surface-light);
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(0, 122, 255, 0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 428px;
            height: 100vh;
            background: var(--background);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: var(--backdrop-blur);
        }

        .modal.active {
            display: block;
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: var(--backdrop-blur);
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-soft);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            padding: 10px 16px;
            border-radius: 12px;
            backdrop-filter: var(--backdrop-blur);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.05);
        }

        .modal-content {
            padding: 24px;
            padding-bottom: 100px;
        }

        /* Day Navigation */
        .day-navigation {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .day-nav-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--glass);
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--backdrop-blur);
        }

        .day-nav-btn:hover {
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.1);
            box-shadow: var(--shadow-medium);
        }

        /* Enhanced Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 122, 255, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 122, 255, 0.6), 0 0 30px rgba(0, 122, 255, 0.4); }
        }

        .session-card {
            animation: fadeIn 0.6s ease-out;
        }

        .exercise-item {
            animation: fadeIn 0.4s ease-out;
            animation-fill-mode: both;
        }

        .exercise-item:nth-child(1) { animation-delay: 0.1s; }
        .exercise-item:nth-child(2) { animation-delay: 0.2s; }
        .exercise-item:nth-child(3) { animation-delay: 0.3s; }
        .exercise-item:nth-child(4) { animation-delay: 0.4s; }
        .exercise-item:nth-child(5) { animation-delay: 0.5s; }
        .exercise-item:nth-child(6) { animation-delay: 0.6s; }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .timer-section.active .timer-time {
            animation: glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="app-title">FitnessPro</div>
                <div class="user-info">75кг • 170см</div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Current Session -->
            <section class="session-card">
                <div class="session-header">
                    <div class="day-navigation">
                        <button class="day-nav-btn" onclick="changeWorkoutDay(-1)">‹</button>
                        <div class="session-date" id="sessionDate">Загрузка...</div>
                        <button class="day-nav-btn" onclick="changeWorkoutDay(1)">›</button>
                    </div>
                    <div class="session-type" id="sessionType">PUSH</div>
                </div>
                <h1 class="session-title" id="sessionTitle">Грудь, плечи, трицепс</h1>
                <div class="session-duration">Запланировано: 10:00 - 12:00 (120 мин)</div>
                <div class="session-stats">
                    <div class="stat">
                        <span class="stat-value" id="completedSets">0</span>
                        <span class="stat-label">Подходов</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="elapsedTime">00:00</span>
                        <span class="stat-label">Время</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="restTime">--:--</span>
                        <span class="stat-label">Отдых</span>
                    </div>
                </div>
                
                <!-- Date Navigation -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button onclick="changeWorkoutDay(-1)" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: none;
                        color: white;
                        padding: 8px 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                    ">← Вчера</button>
                    <span style="font-size: 12px; opacity: 0.8;">Смена программы</span>
                    <button onclick="changeWorkoutDay(1)" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: none;
                        color: white;
                        padding: 8px 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                    ">Завтра →</button>
                </div>
            </section>

            <!-- Progress -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- Exercise List -->
            <section class="exercise-section">
                <h2 class="section-title">Упражнения</h2>
                <div class="exercise-list" id="exerciseList">
                    <!-- Exercises will be populated by JavaScript -->
                </div>
            </section>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="pauseWorkout()">
                    <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="6" y="4" width="4" height="16"/>
                            <rect x="14" y="4" width="4" height="16"/>
                        </svg>
                    </span>
                    <span>Пауза</span>
                </button>
                <button class="btn btn-primary" onclick="completeSet()">
                    <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20,6 9,17 4,12"/>
                        </svg>
                    </span>
                    <span>Подход выполнен</span>
                </button>
            </div>
        </main>

        <!-- Timer Section -->
        <section class="timer-section" id="timerSection">
            <div class="timer-display">
                <div class="timer-time" id="timerTime">2:00</div>
                <div class="timer-label">Отдых между подходами</div>
            </div>
            <div class="timer-controls">
                <button class="timer-btn" onclick="adjustTimer(-30)">-30</button>
                <button class="timer-btn primary" id="timerBtn" onclick="toggleTimer()">▶</button>
                <button class="timer-btn" onclick="adjustTimer(30)">+30</button>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-items">
                <a href="#" class="nav-item active">
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                    </div>
                    <div class="nav-label">Главная</div>
                </a>
                <a href="#" class="nav-item" onclick="openModal('stats')">
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                    </div>
                    <div class="nav-label">Статистика</div>
                </a>
                <a href="#" class="nav-item" onclick="openModal('achievements')">
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z"/>
                        </svg>
                    </div>
                    <div class="nav-label">Достижения</div>
                </a>
                <a href="#" class="nav-item" onclick="openModal('settings')">
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </div>
                    <div class="nav-label">Настройки</div>
                </a>
            </div>
        </nav>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Модальное окно</h3>
            <button class="close-btn" onclick="closeModal()">Закрыть</button>
        </div>
        <div class="modal-content" id="modalContent">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // Application State
        const AppState = {
            currentExercise: 0,
            completedSets: 0,
            workoutStartTime: null,
            isPaused: false,
            pauseStartTime: null,
            currentWorkoutDay: new Date(), // Track current workout day
            timer: {
                isRunning: false,
                timeLeft: 120,
                interval: null
            },
            user: {
                weight: 75,
                height: 170,
                workoutTime: '10:00-12:00',
                goal: 'muscle_gain'
            },
            achievements: {
                unlocked: [],
                stats: {
                    totalWorkouts: 0,
                    totalSets: 0,
                    totalTime: 0,
                    maxStreak: 0,
                    currentStreak: 0,
                    pushExercises: 0,
                    pullExercises: 0,
                    legExercises: 0,
                    heavySets: 0,
                    consecutiveDays: 0,
                    perfectWorkouts: 0,
                    consecutivePerfectWorkouts: 0,
                    longestWorkout: 0,
                    totalCalories: 0,
                    exerciseTypes: {},
                    achievementsUnlocked: 0,
                    // New achievement stats
                    earlyWorkouts: 0,
                    fastWorkouts: 0,
                    ultraFastWorkouts: 0,
                    benchPressCount: 0,
                    pullupCount: 0,
                    squatCount: 0,
                    shortRestWorkouts: 0,
                    weekendWorkouts: 0,
                    monthlyStreak: 0,
                    highVolumeSessions: 0,
                    appUsageDays: 0
                }
            },
            timerSettings: {
                heavy: 180,    // 3:00 for compound exercises
                medium: 120,   // 2:00 for medium exercises
                light: 90      // 1:30 for isolation exercises
            },
            exercises: [
                {
                    name: "Жим штанги лежа",
                    sets: "4 × 6-8",
                    weight: "80кг",
                    restTime: 180,
                    completed: false,
                    currentSet: 0,
                    totalSets: 4,
                    type: 'heavy'
                },
                {
                    name: "Жим гантелей на наклонной",
                    sets: "3 × 8-10",
                    weight: "32кг",
                    restTime: 120,
                    completed: false,
                    currentSet: 0,
                    totalSets: 3,
                    type: 'medium'
                },
                {
                    name: "Жим плеч сидя",
                    sets: "4 × 8-10",
                    weight: "24кг",
                    restTime: 120,
                    completed: false,
                    currentSet: 0,
                    totalSets: 4,
                    type: 'medium'
                },
                {
                    name: "Подъемы в стороны",
                    sets: "3 × 12-15",
                    weight: "12кг",
                    restTime: 90,
                    completed: false,
                    currentSet: 0,
                    totalSets: 3,
                    type: 'light'
                },
                {
                    name: "Французский жим лежа",
                    sets: "3 × 10-12",
                    weight: "20кг",
                    restTime: 90,
                    completed: false,
                    currentSet: 0,
                    totalSets: 3,
                    type: 'light'
                },
                {
                    name: "Отжимания на брусьях",
                    sets: "3 × 8-12",
                    weight: "Собственный",
                    restTime: 120,
                    completed: false,
                    currentSet: 0,
                    totalSets: 3,
                    type: 'medium'
                }
            ]
        };

        // Achievements System
        const ACHIEVEMENTS = {
            // Workout Count Achievements
            FIRST_WORKOUT: {
                id: 'FIRST_WORKOUT',
                name: 'Первые шаги',
                description: 'Завершите свою первую тренировку',
                icon: '🎯',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="#34C759" stroke-width="2" fill="#34C759" opacity="0.2"/><circle cx="12" cy="12" r="6" stroke="#34C759" stroke-width="2" fill="#34C759" opacity="0.4"/><circle cx="12" cy="12" r="2" fill="#34C759"/></svg>',
                condition: (stats) => stats.totalWorkouts >= 1,
                rarity: 'common'
            },
            WORKOUT_WARRIOR: {
                id: 'WORKOUT_WARRIOR',
                name: 'Воин тренировок',
                description: 'Завершите 10 тренировок',
                icon: '⚔️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="#FF6B35" stroke="#FF6B35" stroke-width="1"/></svg>',
                condition: (stats) => stats.totalWorkouts >= 10,
                rarity: 'rare'
            },
            CENTURY_CLUB: {
                id: 'CENTURY_CLUB',
                name: 'Клуб "Сотня"',
                description: 'Завершите 100 тренировок',
                icon: '🏆',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7Z" fill="#FFD700" stroke="#FFD700"/><circle cx="12" cy="12" r="3" fill="#FFF"/></svg>',
                condition: (stats) => stats.totalWorkouts >= 100,
                rarity: 'legendary'
            },
            
            // Sets Achievements  
            SETS_BEGINNER: {
                id: 'SETS_BEGINNER',
                name: 'Начинающий атлет',
                description: 'Выполните 100 подходов',
                icon: '💪',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M20.57 14.86L22 13.43L20.57 12L17 15.57L8.43 7L12 3.43L10.57 2L9.14 3.43L7.71 2L5.57 4.14L4.14 2.71L2.71 4.14L4.14 5.57L2 7.71L3.43 9.14L2 10.57L3.43 12L7 8.43L15.57 17L12 20.57L13.43 22L14.86 20.57L16.29 22L18.43 19.86L19.86 21.29L21.29 19.86L19.86 18.43L22 16.29L20.57 14.86Z" fill="#34C759" stroke="#34C759"/></svg>',
                condition: (stats) => stats.totalSets >= 100,
                rarity: 'common'
            },
            THOUSAND_SETS: {
                id: 'THOUSAND_SETS',
                name: 'Тысяча подходов',
                description: 'Выполните 1000 подходов',
                icon: '🔥',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 0.67s0.74 2.65 0.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l0.03-0.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5 0.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29 0.59 2.65 0.59 4.04 0 2.65-2.15 4.8-4.8 4.8z" fill="#FF6B35"/></svg>',
                condition: (stats) => stats.totalSets >= 1000,
                rarity: 'epic'
            },
            
            // Time Achievements
            HOUR_POWER: {
                id: 'HOUR_POWER',
                name: 'Час силы',
                description: 'Проведите 60 минут в тренировках',
                icon: '⏱️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="#007AFF" stroke-width="2" fill="#007AFF" opacity="0.1"/><polyline points="12,6 12,12 16,14" stroke="#007AFF" stroke-width="2" stroke-linecap="round"/></svg>',
                condition: (stats) => stats.totalTime >= 60,
                rarity: 'common'
            },
            MARATHON_TRAINER: {
                id: 'MARATHON_TRAINER',
                name: 'Марафонец',
                description: 'Проведите 24 часа в тренировках',
                icon: '🏃‍♂️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L9 8.3V13h2V9.6l-.2-.7z" fill="#FF9F0A"/></svg>',
                condition: (stats) => stats.totalTime >= 1440,
                rarity: 'epic'
            },
            
            // Streak Achievements
            CONSISTENCY_KING: {
                id: 'CONSISTENCY_KING',
                name: 'Король постоянства',
                description: 'Тренируйтесь 7 дней подряд',
                icon: '👑',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2.7-2h8.6l.9-5.4-2.1 1.4L12 8l-3.1 2L6.8 8.6L7.7 14z" fill="#FFD700" stroke="#FFD700"/></svg>',
                condition: (stats) => stats.maxStreak >= 7,
                rarity: 'rare'
            },
            IRON_WILL: {
                id: 'IRON_WILL',
                name: 'Железная воля',
                description: 'Тренируйтесь 30 дней подряд',
                icon: '🛡️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10.5V11.5C15.4,11.5 16,12.4 16,13V16C16,17.1 15.1,18 14,18H10C8.9,18 8,17.1 8,16V13C8,12.4 8.4,11.5 9,11.5V10.5C9,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.2,8.7 10.2,10.5V11.5H13.8V10.5C13.8,8.7 12.8,8.2 12,8.2Z" fill="#C0C0C0"/></svg>',
                condition: (stats) => stats.maxStreak >= 30,
                rarity: 'legendary'
            },
            
            // Exercise Type Achievements
            PUSH_MASTER: {
                id: 'PUSH_MASTER',
                name: 'Мастер жимов',
                description: 'Завершите 20 PUSH тренировок',
                icon: '🚀',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L16 14.74L17.18 21.02L12 18.77L6.82 21.02L8 14.74L2 9L8.91 8.26L12 2Z" fill="#FF6B35" stroke="#FF6B35"/></svg>',
                condition: (stats) => stats.pushExercises >= 20,
                rarity: 'rare'
            },
            PULL_CHAMPION: {
                id: 'PULL_CHAMPION',
                name: 'Чемпион тяг',
                description: 'Завершите 20 PULL тренировок',
                icon: '💚',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M9 11H7l3-3 3 3h-2v8h-2v-8zm1-9C6.48 2 3 5.48 3 10s3.48 8 8 8 8-3.48 8-8-3.48-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z" fill="#34C759"/></svg>',
                condition: (stats) => stats.pullExercises >= 20,
                rarity: 'rare'
            },
            LEG_DESTROYER: {
                id: 'LEG_DESTROYER',
                name: 'Разрушитель ног',
                description: 'Завершите 15 LEGS тренировок',
                icon: '🦵',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L9 8.3V13h2V9.6l-.2-.7z" fill="#FF9F0A"/></svg>',
                condition: (stats) => stats.legExercises >= 15,
                rarity: 'rare'
            },
            
            // Perfect Workout Achievements
            PERFECTIONIST: {
                id: 'PERFECTIONIST',
                name: 'Перфекционист',
                description: 'Завершите тренировку на 100%',
                icon: '✨',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z" fill="#FFD700" stroke="#FFD700"/></svg>',
                condition: (stats) => stats.perfectWorkouts >= 1,
                rarity: 'common'
            },
            FLAWLESS_STREAK: {
                id: 'FLAWLESS_STREAK',
                name: 'Безупречная серия',
                description: 'Завершите 5 тренировок подряд на 100%',
                icon: '💎',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M6,2L2,8L12,22L22,8L18,2H6M6.5,4H17.5L20.5,8L12,19L3.5,8L6.5,4M11,6V8H13V6H11M9.5,9V11H14.5V9H9.5Z" fill="#00D4FF"/></svg>',
                condition: (stats) => stats.consecutivePerfectWorkouts >= 5,
                rarity: 'epic'
            },
            
            // Special Achievements
            IRON_MAN: {
                id: 'IRON_MAN',
                name: 'Железный человек',
                description: 'Проведите тренировку дольше 2 часов',
                icon: '🤖',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H9L3 7V9H21M21 10H3V22H21V10Z" fill="#DC143C"/></svg>',
                condition: (stats) => stats.longestWorkout >= 120,
                rarity: 'epic'
            },
            CALORIE_CRUSHER: {
                id: 'CALORIE_CRUSHER',
                name: 'Сжигатель калорий',
                description: 'Сожгите 10,000 калорий',
                icon: '🔥',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 0.67s0.74 2.65 0.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l0.03-0.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5 0.67z" fill="#FF4500"/></svg>',
                condition: (stats) => stats.totalCalories >= 10000,
                rarity: 'legendary'
            },
            
            // Milestone Achievements
            DEDICATION: {
                id: 'DEDICATION',
                name: 'Преданность',
                description: 'Используйте приложение 50 дней',
                icon: '📅',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="#007AFF" stroke-width="2" fill="#007AFF" opacity="0.1"/><line x1="16" y1="2" x2="16" y2="6" stroke="#007AFF" stroke-width="2"/><line x1="8" y1="2" x2="8" y2="6" stroke="#007AFF" stroke-width="2"/><line x1="3" y1="10" x2="21" y2="10" stroke="#007AFF" stroke-width="2"/></svg>',
                condition: (stats) => stats.appUsageDays >= 50,
                rarity: 'rare'
            },
            HEAVY_LIFTER: {
                id: 'HEAVY_LIFTER',
                name: 'Тяжеловес',
                description: 'Выполните 200 тяжелых подходов',
                icon: '🏋️‍♂️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="2" y="10" width="20" height="4" rx="2" fill="#2E2E2E"/><circle cx="5" cy="12" r="3" fill="#2E2E2E"/><circle cx="19" cy="12" r="3" fill="#2E2E2E"/></svg>',
                condition: (stats) => stats.heavySets >= 200,
                rarity: 'epic'
            },

            // Early Bird Achievements
            EARLY_BIRD: {
                id: 'EARLY_BIRD',
                name: 'Ранняя пташка',
                description: 'Начните тренировку до 8:00 утра',
                icon: '🌅',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" fill="#FFD700"/><line x1="12" y1="1" x2="12" y2="3" stroke="#FFD700" stroke-width="2"/><line x1="12" y1="21" x2="12" y2="23" stroke="#FFD700" stroke-width="2"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="#FFD700" stroke-width="2"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="#FFD700" stroke-width="2"/><line x1="1" y1="12" x2="3" y2="12" stroke="#FFD700" stroke-width="2"/><line x1="21" y1="12" x2="23" y2="12" stroke="#FFD700" stroke-width="2"/></svg>',
                condition: (stats) => stats.earlyWorkouts >= 1,
                rarity: 'rare'
            },

            DAWN_WARRIOR: {
                id: 'DAWN_WARRIOR',
                name: 'Воин рассвета',
                description: 'Завершите 10 утренних тренировок (до 8:00)',
                icon: '⚡',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="#FFD700" stroke="#FFD700"/></svg>',
                condition: (stats) => stats.earlyWorkouts >= 10,
                rarity: 'epic'
            },

            // Speed Achievements
            SPEED_DEMON: {
                id: 'SPEED_DEMON',
                name: 'Демон скорости',
                description: 'Завершите тренировку менее чем за 30 минут',
                icon: '💨',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M2 12C2 12 7 4 12 4C17 4 22 12 22 12C22 12 17 20 12 20C7 20 2 12 2 12Z" stroke="#00D4FF" stroke-width="2" fill="#00D4FF" opacity="0.2"/><circle cx="12" cy="12" r="3" fill="#00D4FF"/></svg>',
                condition: (stats) => stats.fastWorkouts >= 1,
                rarity: 'rare'
            },

            LIGHTNING_FAST: {
                id: 'LIGHTNING_FAST',
                name: 'Молниеносный',
                description: 'Завершите тренировку менее чем за 20 минут',
                icon: '⚡',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="#FFD700"/></svg>',
                condition: (stats) => stats.ultraFastWorkouts >= 1,
                rarity: 'epic'
            },

            // Monthly Achievements
            MONTHLY_CHAMPION: {
                id: 'MONTHLY_CHAMPION',
                name: 'Чемпион месяца',
                description: 'Тренируйтесь каждый день в течение месяца',
                icon: '🏆',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7Z" fill="#FFD700"/><path d="M12 8L14 14H10L12 8Z" fill="#FFF"/></svg>',
                condition: (stats) => stats.monthlyStreak >= 30,
                rarity: 'legendary'
            },

            // Exercise Specific Achievements
            BENCH_PRESS_KING: {
                id: 'BENCH_PRESS_KING',
                name: 'Король жима',
                description: 'Выполните жим штанги лежа 50 раз',
                icon: '👑',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2.7-2h8.6l.9-5.4-2.1 1.4L12 8l-3.1 2L6.8 8.6L7.7 14z" fill="#FFD700"/></svg>',
                condition: (stats) => stats.benchPressCount >= 50,
                rarity: 'rare'
            },

            PULLUP_MASTER: {
                id: 'PULLUP_MASTER',
                name: 'Мастер подтягиваний',
                description: 'Выполните подтягивания 100 раз',
                icon: '🎯',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="#34C759" stroke-width="2"/><circle cx="12" cy="12" r="6" stroke="#34C759" stroke-width="2"/><circle cx="12" cy="12" r="2" fill="#34C759"/></svg>',
                condition: (stats) => stats.pullupCount >= 100,
                rarity: 'epic'
            },

            SQUAT_DESTROYER: {
                id: 'SQUAT_DESTROYER',
                name: 'Разрушитель приседов',
                description: 'Выполните приседания 200 раз',
                icon: '💥',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L16 14.74L17.18 21.02L12 18.77L6.82 21.02L8 14.74L2 9L8.91 8.26L12 2Z" fill="#FF6B35"/></svg>',
                condition: (stats) => stats.squatCount >= 200,
                rarity: 'epic'
            },

            // Rest Time Achievements
            NO_REST_WARRIOR: {
                id: 'NO_REST_WARRIOR',
                name: 'Неутомимый воин',
                description: 'Завершите тренировку с отдыхом менее 60 сек между подходами',
                icon: '🔥',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 0.67s0.74 2.65 0.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l0.03-0.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5 0.67z" fill="#FF4500"/></svg>',
                condition: (stats) => stats.shortRestWorkouts >= 1,
                rarity: 'rare'
            },

            // Weekend Achievements
            WEEKEND_WARRIOR: {
                id: 'WEEKEND_WARRIOR',
                name: 'Воин выходных',
                description: 'Тренируйтесь 10 выходных подряд',
                icon: '🛡️',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z" fill="#C0C0C0" stroke="#C0C0C0"/></svg>',
                condition: (stats) => stats.weekendWorkouts >= 10,
                rarity: 'rare'
            },

            // Volume Achievements
            HIGH_VOLUME: {
                id: 'HIGH_VOLUME',
                name: 'Объемный тренинг',
                description: 'Выполните за тренировку более 30 подходов',
                icon: '�',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="#007AFF" stroke-width="2" fill="#007AFF" opacity="0.1"/><path d="M9 17V7l4 4 4-4v10" stroke="#007AFF" stroke-width="2" fill="none"/></svg>',
                condition: (stats) => stats.highVolumeSessions >= 1,
                rarity: 'rare'
            },

            // Achievement Hunter
            ACHIEVEMENT_HUNTER: {
                id: 'ACHIEVEMENT_HUNTER',
                name: 'Охотник за достижениями',
                description: 'Разблокируйте 10 достижений',
                icon: '🏅',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="6" fill="#FFD700" stroke="#FFD700"/><path d="M15.5 13.5L19 21l-3-1-4 1-4-1-3 1 3.5-7.5" fill="#FF6B35" stroke="#FF6B35"/></svg>',
                condition: (stats) => stats.achievementsUnlocked >= 10,
                rarity: 'epic'
            },

            COMPLETIONIST: {
                id: 'COMPLETIONIST',
                name: 'Перфекционист',
                description: 'Разблокируйте все достижения',
                icon: '💎',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M6,2L2,8L12,22L22,8L18,2H6M6.5,4H17.5L20.5,8L12,19L3.5,8L6.5,4Z" fill="#00D4FF"/></svg>',
                condition: (stats) => stats.achievementsUnlocked >= Object.keys(ACHIEVEMENTS).length - 1,
                rarity: 'legendary'
            },

            // Consistency and Dedication Achievements
            WEEK_WARRIOR: {
                id: 'WEEK_WARRIOR',
                name: 'Воин недели',
                description: 'Тренируйтесь 7 дней подряд',
                icon: '�',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" fill="#4ECDC4" opacity="0.2" stroke="#4ECDC4" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="6" stroke="#4ECDC4" stroke-width="2"/><line x1="8" y1="2" x2="8" y2="6" stroke="#4ECDC4" stroke-width="2"/><line x1="3" y1="10" x2="21" y2="10" stroke="#4ECDC4" stroke-width="2"/></svg>',
                condition: (stats) => stats.currentStreak >= 7,
                rarity: 'rare'
            },

            MARATHON_TRAINER: {
                id: 'MARATHON_TRAINER',
                name: 'Марафонец тренировок',
                description: 'Завершите тренировку длительностью более 2 часов',
                icon: '🏃',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.5 5.5C14.61 5.5 15.5 4.61 15.5 3.5S14.61 1.5 13.5 1.5 11.5 2.39 11.5 3.5 12.39 5.5 13.5 5.5M9.89 19.38L10.89 15L13 17V23H11V18.89L9.89 19.38M14 2V8L12.8 8.8L15.5 13.5L17.5 12L14.8 7.2L16 6V2H14M8.5 12.5L11 14L10 18L4 16L5 14L8.5 12.5Z" fill="#FF6B6B"/></svg>',
                condition: (stats) => stats.longestWorkout >= 120,
                rarity: 'epic'
            },

            MORNING_LEGEND: {
                id: 'MORNING_LEGEND',
                name: 'Легенда утра',
                description: 'Завершите 25 утренних тренировок',
                icon: '🌄',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M6 18L8 18L10 16L14 16L16 18L18 18L18 9L12 4L6 9V18Z" fill="#FFD700"/><path d="M12 4L6 9L18 9Z" fill="#FF6B35"/></svg>',
                condition: (stats) => stats.earlyWorkouts >= 25,
                rarity: 'legendary'
            },

            WEEKEND_CHAMPION: {
                id: 'WEEKEND_CHAMPION',
                name: 'Чемпион выходных',
                description: 'Завершите 15 тренировок в выходные дни',
                icon: '�',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z" fill="#FFD700"/></svg>',
                condition: (stats) => stats.weekendWorkouts >= 15,
                rarity: 'epic'
            },

            SPEED_MASTER: {
                id: 'SPEED_MASTER',
                name: 'Мастер скорости',
                description: 'Завершите 15 быстрых тренировок (менее 30 минут)',
                icon: '💨',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M2 15L22 15M2 12L16 12M2 18L18 18" stroke="#00D4FF" stroke-width="2" fill="none"/></svg>',
                condition: (stats) => stats.fastWorkouts >= 15,
                rarity: 'epic'
            },

            REST_EFFICIENCY: {
                id: 'REST_EFFICIENCY',
                name: 'Эксперт по отдыху',
                description: 'Завершите 20 тренировок с короткими перерывами',
                icon: '⚡',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="#00D4FF"/></svg>',
                condition: (stats) => stats.shortRestWorkouts >= 20,
                rarity: 'epic'
            },

            VOLUME_KING: {
                id: 'VOLUME_KING',
                name: 'Король объемов',
                description: 'Завершите 10 высокообъемных тренировок (>20 сетов)',
                icon: '👑',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 16L3 18V20H21V18L19 16V10C19 7.24 16.76 5 14 5H10C7.24 5 5 7.24 5 10V16Z" fill="#FFD700" stroke="#FFD700"/><polygon points="12,2 13.5,6.5 18,5 16,9 12,8 8,9 6,5 10.5,6.5" fill="#FFD700"/></svg>',
                condition: (stats) => stats.highVolumeSessions >= 10,
                rarity: 'legendary'
            },

            APP_VETERAN: {
                id: 'APP_VETERAN',
                name: 'Ветеран приложения',
                description: 'Используйте приложение 30 дней',
                icon: '�',
                svgIcon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="12" fill="#4ECDC4" opacity="0.2" stroke="#4ECDC4" stroke-width="2"/><path d="M3 7L12 2L21 7" stroke="#4ECDC4" stroke-width="2" fill="none"/><line x1="7" y1="10" x2="7" y2="16" stroke="#4ECDC4" stroke-width="2"/><line x1="12" y1="10" x2="12" y2="16" stroke="#4ECDC4" stroke-width="2"/><line x1="17" y1="10" x2="17" y2="16" stroke="#4ECDC4" stroke-width="2"/></svg>',
                condition: (stats) => stats.appUsageDays >= 30,
                rarity: 'rare'
            }
        };

        // Exercise Instructions Database
        const EXERCISE_INSTRUCTIONS = {
            "Жим штанги лежа": {
                description: "Базовое упражнение для развития грудных мышц",
                instructions: [
                    "Лягте на скамью, глаза под грифом штанги",
                    "Возьмитесь за гриф широким хватом (шире плеч)",
                    "Снимите штангу со стоек и держите над грудью",
                    "Медленно опустите штангу к груди",
                    "Мощно выжмите штангу вверх до полного выпрямления рук",
                    "Контролируйте дыхание: вдох при опускании, выдох при подъеме"
                ],
                tips: [
                    "Держите лопатки сведенными",
                    "Не отрывайте таз от скамьи",
                    "Контролируйте негативную фазу движения"
                ],
                muscles: ["Грудные мышцы", "Трицепс", "Передние дельты"]
            },
            "Жим гантелей на наклонной": {
                description: "Упражнение для верхней части грудных мышц",
                instructions: [
                    "Установите скамью под углом 30-45 градусов",
                    "Возьмите гантели и лягте на скамью",
                    "Поднимите гантели над верхней частью груди",
                    "Медленно опустите гантели до уровня груди",
                    "Выжмите гантели вверх, сводя их слегка в верхней точке"
                ],
                tips: [
                    "Не делайте угол наклона больше 45°",
                    "Контролируйте траекторию движения",
                    "Не сталкивайте гантели в верхней точке"
                ],
                muscles: ["Верх груди", "Трицепс", "Передние дельты"]
            },
            "Разводка гантелей лежа": {
                description: "Изолирующее упражнение для грудных мышц",
                instructions: [
                    "Лягте на скамью с гантелями в руках",
                    "Поднимите гантели над грудью, слегка согнув локти",
                    "Медленно разведите руки в стороны",
                    "Опустите гантели до уровня груди",
                    "Сведите руки обратно над грудью"
                ],
                tips: [
                    "Сохраняйте небольшой изгиб в локтях",
                    "Не опускайте гантели слишком низко",
                    "Концентрируйтесь на растяжении груди"
                ],
                muscles: ["Грудные мышцы", "Передние дельты"]
            },
            "Жим плеч сидя": {
                description: "Базовое упражнение для дельтовидных мышц",
                instructions: [
                    "Сядьте на скамью с вертикальной спинкой",
                    "Возьмите гантели и поднимите их к плечам",
                    "Выжмите гантели вверх над головой",
                    "Медленно опустите гантели к плечам",
                    "Повторите движение"
                ],
                tips: [
                    "Держите спину прямой",
                    "Не блокируйте локти в верхней точке",
                    "Контролируйте движение гантелей"
                ],
                muscles: ["Дельтовидные мышцы", "Трицепс", "Верх груди"]
            },
            "Подъемы в стороны": {
                description: "Изолирующее упражнение для средних дельт",
                instructions: [
                    "Встаньте прямо, гантели в руках по бокам",
                    "Слегка наклонитесь вперед",
                    "Поднимите руки в стороны до уровня плеч",
                    "Медленно опустите руки в исходное положение",
                    "Сохраняйте небольшой изгиб в локтях"
                ],
                tips: [
                    "Не поднимайте руки выше плеч",
                    "Контролируйте негативную фазу",
                    "Не раскачивайтесь корпусом"
                ],
                muscles: ["Средние дельты", "Задние дельты"]
            },
            "Жим лежа узким хватом": {
                description: "Упражнение для трицепса и внутренней части груди",
                instructions: [
                    "Лягте на скамью, возьмитесь за гриф узким хватом",
                    "Руки на ширине плеч или уже",
                    "Снимите штангу со стоек",
                    "Опустите штангу к нижней части груди",
                    "Выжмите штангу вверх, концентрируясь на трицепсах"
                ],
                tips: [
                    "Держите локти близко к телу",
                    "Не делайте слишком узкий хват",
                    "Контролируйте штангу на протяжении всего движения"
                ],
                muscles: ["Трицепс", "Внутренняя часть груди", "Передние дельты"]
            },
            "Французский жим лежа": {
                description: "Изолирующее упражнение для трицепса",
                instructions: [
                    "Лягте на скамью, возьмите штангу или гантели",
                    "Поднимите снаряд над грудью",
                    "Согните руки в локтях, опуская вес к голове",
                    "Разогните руки, возвращая вес в исходное положение",
                    "Работают только предплечья"
                ],
                tips: [
                    "Держите локти неподвижными",
                    "Не разводите локти в стороны",
                    "Контролируйте негативную фазу"
                ],
                muscles: ["Трицепс", "Предплечья"]
            },
            "Отжимания на брусьях": {
                description: "Базовое упражнение для трицепса и груди",
                instructions: [
                    "Займите положение на брусьях на прямых руках",
                    "Слегка наклоните корпус вперед",
                    "Медленно опуститесь, сгибая руки в локтях",
                    "Опускайтесь до комфортного растяжения в груди",
                    "Мощно выжмите себя в исходное положение"
                ],
                tips: [
                    "Не опускайтесь слишком глубоко",
                    "Контролируйте скорость опускания",
                    "Наклон вперед больше нагружает грудь"
                ],
                muscles: ["Трицепс", "Нижняя часть груди", "Передние дельты"]
            },
            "Планка": {
                description: "Статическое упражнение для кора",
                instructions: [
                    "Примите упор лежа на предплечьях",
                    "Локти под плечами, тело прямое",
                    "Напрягите пресс и ягодицы",
                    "Держите позицию заданное время",
                    "Дышите ровно и спокойно"
                ],
                tips: [
                    "Не поднимайте таз вверх",
                    "Не прогибайтесь в пояснице",
                    "Смотрите в пол перед собой"
                ],
                muscles: ["Пресс", "Кор", "Плечи", "Ягодицы"]
            },
            // PULL Exercises
            "Подтягивания широким хватом": {
                description: "Базовое упражнение для широчайших мышц спины",
                instructions: [
                    "Возьмитесь за перекладину широким хватом",
                    "Повисните на прямых руках",
                    "Подтянитесь, сводя лопатки",
                    "Поднимайтесь до касания подбородком перекладины",
                    "Медленно опуститесь в исходное положение"
                ],
                tips: [
                    "Не раскачивайтесь во время выполнения",
                    "Сводите лопатки в начале движения",
                    "Контролируйте негативную фазу"
                ],
                muscles: ["Широчайшие мышцы", "Бицепс", "Задние дельты"]
            },
            "Тяга штанги в наклоне": {
                description: "Базовое упражнение для мышц спины",
                instructions: [
                    "Наклонитесь вперед под углом 45-60 градусов",
                    "Возьмитесь за штангу прямым хватом",
                    "Тяните штангу к нижней части живота",
                    "Сводите лопатки в верхней точке",
                    "Медленно опустите штангу вниз"
                ],
                tips: [
                    "Держите спину прямой",
                    "Не используйте инерцию",
                    "Тяните локтями, а не руками"
                ],
                muscles: ["Широчайшие мышцы", "Ромбовидные", "Бицепс"]
            },
            "Подъемы на бицепс стоя": {
                description: "Основное упражнение для бицепса",
                instructions: [
                    "Встаньте прямо, гантели в руках",
                    "Руки опущены вдоль тела",
                    "Поднимите гантели к плечам, сгибая руки",
                    "Сожмите бицепс в верхней точке",
                    "Медленно опустите гантели вниз"
                ],
                tips: [
                    "Не раскачивайте корпус",
                    "Держите локти прижатыми к телу",
                    "Контролируйте движение"
                ],
                muscles: ["Бицепс", "Предплечья"]
            },
            "Молотковые сгибания": {
                description: "Упражнение для бицепса и предплечий",
                instructions: [
                    "Возьмите гантели нейтральным хватом",
                    "Встаньте прямо, руки вдоль тела",
                    "Поднимайте гантели, не поворачивая кисти",
                    "Сжимайте мышцы в верхней точке",
                    "Медленно опускайте гантели"
                ],
                tips: [
                    "Сохраняйте нейтральный хват",
                    "Не используйте инерцию",
                    "Концентрируйтесь на предплечьях"
                ],
                muscles: ["Бицепс", "Плечевая мышца", "Предплечья"]
            },
            "Сгибания на скамье Скотта": {
                description: "Изолирующее упражнение для бицепса",
                instructions: [
                    "Сядьте на скамью Скотта",
                    "Положите руки на наклонную подушку",
                    "Возьмите гантель или штангу",
                    "Поднимайте вес, сгибая руки",
                    "Медленно опускайте до легкого растяжения"
                ],
                tips: [
                    "Не разгибайте руки полностью",
                    "Контролируйте негативную фазу",
                    "Используйте полную амплитуду"
                ],
                muscles: ["Бицепс", "Предплечья"]
            },
            "Тяга верхнего блока": {
                description: "Упражнение для широчайших мышц спины",
                instructions: [
                    "Сядьте к тренажеру, возьмитесь за рукоять",
                    "Слегка отклонитесь назад",
                    "Тяните рукоять к верхней части груди",
                    "Сводите лопатки в нижней точке",
                    "Медленно отпускайте рукоять вверх"
                ],
                tips: [
                    "Не тяните руками, работайте спиной",
                    "Держите грудь расправленной",
                    "Контролируйте скорость движения"
                ],
                muscles: ["Широчайшие мышцы", "Ромбовидные", "Бицепс"]
            },
            "Обратные отжимания": {
                description: "Упражнение для трицепса и задних дельт",
                instructions: [
                    "Сядьте спиной к скамье",
                    "Упритесь руками в край скамьи",
                    "Опустите тело, сгибая руки в локтях",
                    "Выжмите себя обратно в исходное положение",
                    "Работайте в полной амплитуде"
                ],
                tips: [
                    "Держите локти близко к телу",
                    "Не опускайтесь слишком глубоко",
                    "Контролируйте движение"
                ],
                muscles: ["Трицепс", "Задние дельты", "Грудные мышцы"]
            },
            "Подъемы ног в висе": {
                description: "Упражнение для нижнего пресса",
                instructions: [
                    "Повисните на перекладине",
                    "Слегка согните ноги в коленях",
                    "Поднимите ноги до параллели с полом",
                    "Задержитесь в верхней точке",
                    "Медленно опустите ноги вниз"
                ],
                tips: [
                    "Не раскачивайтесь во время выполнения",
                    "Концентрируйтесь на работе пресса",
                    "Поднимайте ноги силой мышц, а не инерцией"
                ],
                muscles: ["Нижний пресс", "Сгибатели бедра", "Предплечья"]
            },
            // LEGS Exercises
            "Приседания со штангой": {
                description: "Базовое упражнение для ног и ягодиц",
                instructions: [
                    "Поставьте штангу на плечи (трапеции)",
                    "Ноги на ширине плеч, носки слегка развернуты",
                    "Медленно опуститесь, отводя таз назад",
                    "Опускайтесь до параллели бедер с полом",
                    "Мощно поднимитесь в исходное положение"
                ],
                tips: [
                    "Держите спину прямой",
                    "Колени направлены в сторону носков",
                    "Опускайтесь медленно, поднимайтесь быстро"
                ],
                muscles: ["Квадрицепс", "Ягодицы", "Задняя поверхность бедра"]
            },
            "Румынская тяга": {
                description: "Упражнение для задней поверхности бедра",
                instructions: [
                    "Возьмите штангу прямым хватом",
                    "Встаньте прямо, ноги на ширине плеч",
                    "Наклонитесь вперед, отводя таз назад",
                    "Опускайте штангу вдоль ног",
                    "Вернитесь в исходное положение"
                ],
                tips: [
                    "Держите штангу близко к ногам",
                    "Не округляйте спину",
                    "Чувствуйте растяжение в задней поверхности бедра"
                ],
                muscles: ["Задняя поверхность бедра", "Ягодицы", "Поясница"]
            },
            "Жим ногами": {
                description: "Базовое упражнение для ног в тренажере",
                instructions: [
                    "Сядьте в тренажер для жима ногами",
                    "Поставьте ноги на платформу на ширине плеч",
                    "Опустите платформу, сгибая ноги в коленях",
                    "Опускайтесь до угла 90° в коленях",
                    "Выжмите платформу в исходное положение"
                ],
                tips: [
                    "Не блокируйте колени в верхней точке",
                    "Держите спину прижатой к спинке",
                    "Используйте полную амплитуду движения"
                ],
                muscles: ["Квадрицепс", "Ягодицы", "Задняя поверхность бедра"]
            },
            "Скручивания лежа": {
                description: "Основное упражнение для пресса",
                instructions: [
                    "Лягте на спину, ноги согнуты в коленях",
                    "Руки за головой или на груди",
                    "Поднимите верх тела к коленям",
                    "Скручивайте позвоночник, а не поднимайте корпус",
                    "Медленно опуститесь в исходное положение"
                ],
                tips: [
                    "Не тяните за шею руками",
                    "Выдыхайте при подъеме",
                    "Концентрируйтесь на работе пресса"
                ],
                muscles: ["Прямая мышца живота", "Косые мышцы"]
            },
            "Русские скручивания": {
                description: "Упражнение для косых мышц живота",
                instructions: [
                    "Сядьте на пол, ноги согнуты в коленях",
                    "Слегка отклонитесь назад",
                    "Поднимите ноги или держите их на весу",
                    "Поворачивайте корпус в стороны",
                    "Можете держать в руках вес"
                ],
                tips: [
                    "Держите спину прямой",
                    "Поворачивайтесь всем корпусом",
                    "Контролируйте движение"
                ],
                muscles: ["Косые мышцы живота", "Прямая мышца живота", "Кор"]
            },
            "Велосипед": {
                description: "Динамическое упражнение для пресса",
                instructions: [
                    "Лягте на спину, руки за головой",
                    "Поднимите ноги и плечи",
                    "Поочередно подтягивайте колени к груди",
                    "Одновременно поворачивайте корпус",
                    "Имитируйте езду на велосипеде"
                ],
                tips: [
                    "Не спешите, контролируйте движение",
                    "Полностью выпрямляйте ногу",
                    "Поворачивайтесь всем корпусом"
                ],
                muscles: ["Косые мышцы живота", "Прямая мышца живота", "Сгибатели бедра"]
            },
            "Горизонт": {
                description: "Статическое упражнение для кора",
                instructions: [
                    "Примите упор лежа на руках",
                    "Поднимите одну руку и противоположную ногу",
                    "Держите тело прямо и стабильно",
                    "Удерживайте позицию заданное время",
                    "Поменяйте руку и ногу"
                ],
                tips: [
                    "Не поворачивайте таз",
                    "Держите голову в нейтральном положении",
                    "Напрягайте пресс и ягодицы"
                ],
                muscles: ["Кор", "Ягодицы", "Плечи", "Мышцы-стабилизаторы"]
            }
        };

        // Achievement Functions
        function checkAchievements() {
            const newUnlocked = [];
            
            Object.values(ACHIEVEMENTS).forEach(achievement => {
                if (!AppState.achievements.unlocked.includes(achievement.id) && 
                    achievement.condition(AppState.achievements.stats)) {
                    AppState.achievements.unlocked.push(achievement.id);
                    newUnlocked.push(achievement);
                }
            });
            
            if (newUnlocked.length > 0) {
                showAchievementNotification(newUnlocked);
                saveAchievements();
            }
        }

        function showAchievementNotification(achievements) {
            achievements.forEach((achievement, index) => {
                setTimeout(() => {
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: ${120 + index * 80}px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                        color: #2D3748;
                        padding: 16px 20px;
                        border-radius: 16px;
                        font-weight: 600;
                        z-index: 1003;
                        box-shadow: 0 12px 40px rgba(255, 215, 0, 0.4);
                        max-width: 320px;
                        text-align: center;
                        animation: achievementSlide 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                        border: 2px solid rgba(255, 255, 255, 0.3);
                    `;
                    
                    notification.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 32px;">${achievement.svgIcon}</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 700; margin-bottom: 4px;">🏆 Достижение разблокировано!</div>
                                <div style="font-size: 14px; font-weight: 600; margin-bottom: 2px;">${achievement.name}</div>
                                <div style="font-size: 12px; opacity: 0.8;">${achievement.description}</div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Play achievement sound (if available)
                    if ('vibrate' in navigator) {
                        navigator.vibrate([100, 50, 100, 50, 200]);
                    }
                    
                    setTimeout(() => {
                        notification.style.animation = 'achievementSlideOut 0.4s ease-in';
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.remove();
                            }
                        }, 400);
                    }, 4000);
                }, index * 500);
            });
        }

        function updateAchievementStats(type, value = 1) {
            const stats = AppState.achievements.stats;
            const now = new Date();
            
            switch(type) {
                case 'workout_completed':
                    stats.totalWorkouts += value;
                    // Check for early morning workouts (before 8 AM)
                    if (now.getHours() < 8) {
                        stats.earlyWorkouts = (stats.earlyWorkouts || 0) + 1;
                    }
                    // Check for weekend workouts
                    if (now.getDay() === 0 || now.getDay() === 6) {
                        stats.weekendWorkouts = (stats.weekendWorkouts || 0) + 1;
                    }
                    break;
                case 'set_completed':
                    stats.totalSets += value;
                    break;
                case 'time_spent':
                    stats.totalTime += value;
                    // Check for fast workouts
                    if (value < 30) {
                        stats.fastWorkouts = (stats.fastWorkouts || 0) + 1;
                    }
                    if (value < 20) {
                        stats.ultraFastWorkouts = (stats.ultraFastWorkouts || 0) + 1;
                    }
                    break;
                case 'push_workout':
                    stats.pushExercises += value;
                    break;
                case 'pull_workout':
                    stats.pullExercises += value;
                    break;
                case 'leg_workout':
                    stats.legExercises += value;
                    break;
                case 'heavy_set':
                    stats.heavySets += value;
                    break;
                case 'perfect_workout':
                    stats.perfectWorkouts += value;
                    stats.consecutivePerfectWorkouts = (stats.consecutivePerfectWorkouts || 0) + 1;
                    break;
                case 'imperfect_workout':
                    stats.consecutivePerfectWorkouts = 0;
                    break;
                case 'longest_workout':
                    if (value > (stats.longestWorkout || 0)) {
                        stats.longestWorkout = value;
                    }
                    break;
                case 'calories_burned':
                    stats.totalCalories += value;
                    break;
                case 'streak_update':
                    stats.currentStreak = value;
                    if (value > (stats.maxStreak || 0)) {
                        stats.maxStreak = value;
                    }
                    if (value >= 30) {
                        stats.monthlyStreak = Math.max(stats.monthlyStreak || 0, value);
                    }
                    break;
                case 'high_volume_session':
                    stats.highVolumeSessions = (stats.highVolumeSessions || 0) + 1;
                    break;
                case 'short_rest_workout':
                    stats.shortRestWorkouts = (stats.shortRestWorkouts || 0) + 1;
                    break;
                case 'app_usage_day':
                    stats.appUsageDays = (stats.appUsageDays || 0) + 1;
                    break;
                case 'exercise_specific':
                    const exerciseName = value.toLowerCase();
                    if (exerciseName.includes('жим штанги лежа') || exerciseName.includes('bench press')) {
                        stats.benchPressCount = (stats.benchPressCount || 0) + 1;
                    }
                    if (exerciseName.includes('подтягивания') || exerciseName.includes('pullup') || exerciseName.includes('pull-up')) {
                        stats.pullupCount = (stats.pullupCount || 0) + 1;
                    }
                    if (exerciseName.includes('приседания') || exerciseName.includes('squat')) {
                        stats.squatCount = (stats.squatCount || 0) + 1;
                    }
                    break;
            }
            
            saveAchievements();
            checkAchievements();
        }

        function saveAchievements() {
            localStorage.setItem('fitnessProAchievements', JSON.stringify(AppState.achievements));
        }

        function loadAchievements() {
            const saved = localStorage.getItem('fitnessProAchievements');
            if (saved) {
                const savedAchievements = JSON.parse(saved);
                AppState.achievements = {
                    ...AppState.achievements,
                    ...savedAchievements
                };
            }
        }

        // Update Date Display and Workout Type
        function updateDateDisplay() {
            const days = ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'];
            const months = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 
                           'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
            
            const currentDay = AppState.currentWorkoutDay;
            const dayName = days[currentDay.getDay()];
            const day = currentDay.getDate();
            const month = months[currentDay.getMonth()];
            
            // Update date display
            const sessionDateElement = document.getElementById('sessionDate');
            if (sessionDateElement) {
                sessionDateElement.textContent = `${dayName}, ${day} ${month}`;
            }
            
            // Update workout type based on day
            updateWorkoutType(currentDay.getDay());
        }

        // Function to change workout day
        function changeWorkoutDay(direction) {
            const newDate = new Date(AppState.currentWorkoutDay);
            newDate.setDate(newDate.getDate() + direction);
            AppState.currentWorkoutDay = newDate;
            
            // Reset workout state when changing days
            AppState.workoutStartTime = new Date();
            
            updateDateDisplay();
        }

        function updateWorkoutType(dayOfWeek) {
            const workoutSchedule = {
                1: { type: 'PUSH', title: 'Грудь, плечи, трицепс + пресс', exercises: 'pushExercises' }, // Понедельник
                2: { type: 'PULL', title: 'Спина, бицепс + пресс', exercises: 'pullExercises' },          // Вторник  
                3: { type: 'LEGS', title: 'Ноги + основной пресс', exercises: 'legExercises' },          // Среда
                4: { type: 'REST', title: 'День отдыха + растяжка', exercises: 'restDay' },                 // Четверг
                5: { type: 'PUSH', title: 'Грудь, плечи, трицепс + пресс', exercises: 'pushExercises' }, // Пятница
                6: { type: 'PULL', title: 'Спина, бицепс + пресс', exercises: 'pullExercises' },          // Суббота
                0: { type: 'REST', title: 'День отдыха + растяжка', exercises: 'restDay' }                  // Воскресенье
            };

            const todayWorkout = workoutSchedule[dayOfWeek];
            
            // Update session type and title
            const sessionTypeElement = document.getElementById('sessionType');
            const sessionTitleElement = document.getElementById('sessionTitle');
            
            if (sessionTypeElement && sessionTitleElement) {
                sessionTypeElement.textContent = todayWorkout.type;
                sessionTitleElement.textContent = todayWorkout.title;
                
                // Update session type styling based on workout
                sessionTypeElement.className = 'session-type';
                if (todayWorkout.type === 'REST') {
                    sessionTypeElement.style.background = 'rgba(128, 128, 128, 0.3)';
                } else if (todayWorkout.type === 'PUSH') {
                    sessionTypeElement.style.background = 'rgba(255, 107, 53, 0.3)'; // Orange
                } else if (todayWorkout.type === 'PULL') {
                    sessionTypeElement.style.background = 'rgba(52, 199, 89, 0.3)'; // Green
                } else if (todayWorkout.type === 'LEGS') {
                    sessionTypeElement.style.background = 'rgba(255, 159, 10, 0.3)'; // Yellow
                }
            }
            
            // Update exercises based on workout type
            updateExercisesForWorkout(todayWorkout.exercises);
        }

        function updateExercisesForWorkout(workoutType) {
            let exercises = [];
            
            switch(workoutType) {
                case 'pushExercises':
                    exercises = [
                        { name: "Жим штанги лежа", sets: "4 × 6-8", weight: "80кг", restTime: 180, type: 'heavy', totalSets: 4 },
                        { name: "Жим гантелей на наклонной", sets: "4 × 8-10", weight: "32кг", restTime: 120, type: 'medium', totalSets: 4 },
                        { name: "Разводка гантелей лежа", sets: "3 × 10-12", weight: "16кг", restTime: 90, type: 'light', totalSets: 3 },
                        { name: "Жим плеч сидя", sets: "4 × 8-10", weight: "24кг", restTime: 120, type: 'medium', totalSets: 4 },
                        { name: "Подъемы в стороны", sets: "4 × 12-15", weight: "12кг", restTime: 90, type: 'light', totalSets: 4 },
                        { name: "Жим лежа узким хватом", sets: "3 × 8-10", weight: "60кг", restTime: 120, type: 'medium', totalSets: 3 },
                        { name: "Французский жим лежа", sets: "3 × 10-12", weight: "20кг", restTime: 90, type: 'light', totalSets: 3 },
                        { name: "Отжимания на брусьях", sets: "3 × 8-12", weight: "Собственный", restTime: 120, type: 'medium', totalSets: 3 },
                        { name: "Планка", sets: "3 × 60 сек", weight: "Собственный", restTime: 90, type: 'light', totalSets: 3 }
                    ];
                    break;
                case 'pullExercises':
                    exercises = [
                        { name: "Подтягивания широким хватом", sets: "4 × 6-10", weight: "Собственный", restTime: 180, type: 'heavy', totalSets: 4 },
                        { name: "Тяга штанги в наклоне", sets: "4 × 8-10", weight: "70кг", restTime: 120, type: 'medium', totalSets: 4 },
                        { name: "Подъемы на бицепс стоя", sets: "4 × 10-12", weight: "18кг", restTime: 90, type: 'light', totalSets: 4 },
                        { name: "Молотковые сгибания", sets: "4 × 10-12", weight: "16кг", restTime: 90, type: 'light', totalSets: 4 },
                        { name: "Сгибания на скамье Скотта", sets: "3 × 8-10", weight: "14кг", restTime: 90, type: 'light', totalSets: 3 },
                        { name: "Тяга верхнего блока", sets: "3 × 10-12", weight: "55кг", restTime: 120, type: 'medium', totalSets: 3 },
                        { name: "Обратные отжимания", sets: "3 × 10-15", weight: "Собственный", restTime: 90, type: 'light', totalSets: 3 },
                        { name: "Подъемы ног в висе", sets: "4 × 12-15", weight: "Собственный", restTime: 90, type: 'light', totalSets: 4 }
                    ];
                    break;
                case 'legExercises':
                    exercises = [
                        { name: "Приседания со штангой", sets: "3 × 8-10", weight: "90кг", restTime: 180, type: 'heavy', totalSets: 3 },
                        { name: "Румынская тяга", sets: "3 × 8-10", weight: "70кг", restTime: 120, type: 'medium', totalSets: 3 },
                        { name: "Жим ногами", sets: "3 × 12-15", weight: "120кг", restTime: 120, type: 'medium', totalSets: 3 },
                        { name: "Скручивания лежа", sets: "4 × 15-20", weight: "Собственный", restTime: 60, type: 'light', totalSets: 4 },
                        { name: "Русские скручивания", sets: "4 × 20-25", weight: "10кг", restTime: 60, type: 'light', totalSets: 4 },
                        { name: "Велосипед", sets: "3 × 30 сек", weight: "Собственный", restTime: 60, type: 'light', totalSets: 3 },
                        { name: "Горизонт", sets: "3 × 45 сек", weight: "Собственный", restTime: 90, type: 'light', totalSets: 3 }
                    ];
                    break;
                case 'restDay':
                    exercises = [
                        { name: "Легкая растяжка", sets: "15 минут", weight: "Собственный", restTime: 60, type: 'light', totalSets: 1 },
                        { name: "Ходьба", sets: "30 минут", weight: "Собственный", restTime: 0, type: 'light', totalSets: 1 },
                        { name: "Дыхательные упражнения", sets: "10 минут", weight: "Собственный", restTime: 60, type: 'light', totalSets: 1 }
                    ];
                    break;
                default:
                    exercises = AppState.exercises;
            }
            
            // Reset exercise states
            AppState.exercises = exercises.map(ex => ({
                ...ex,
                completed: false,
                currentSet: 0
            }));
            
            // Reset workout state
            AppState.currentExercise = 0;
            AppState.completedSets = 0;
            
            // Update UI
            renderExercises();
            updateProgress();
            updateStats();
        }

        function isWorkoutComplete() {
            const allCompleted = AppState.exercises.every(exercise => exercise.completed);
            console.log('Проверка завершения тренировки:', {
                allCompleted,
                exercises: AppState.exercises.map(ex => ({ 
                    name: ex.name, 
                    completed: ex.completed, 
                    currentSet: ex.currentSet, 
                    totalSets: ex.totalSets 
                }))
            });
            return allCompleted;
        }

        // Enhanced Complete Set Function with improved validation
        function completeSet() {
            if (AppState.isPaused) {
                showNotification('Снимите тренировку с паузы для продолжения', 'warning');
                return;
            }
            
            const currentExercise = AppState.exercises[AppState.currentExercise];
            
            // Улучшенная валидация
            if (!currentExercise) {
                showNotification('Ошибка: упражнение не найдено', 'error');
                return;
            }
            
            if (currentExercise.completed) {
                showNotification('Упражнение уже завершено', 'warning');
                return;
            }

            // Validate exercise completion
            if (currentExercise.currentSet >= currentExercise.totalSets) {
                showNotification('Все подходы уже выполнены', 'warning');
                return;
            }

            currentExercise.currentSet++;
            AppState.completedSets++;

            // Update achievement stats
            updateAchievementStats('set_completed', 1);
            if (currentExercise.type === 'heavy') {
                updateAchievementStats('heavy_set', 1);
            }

            // Show set completion feedback
            showSetCompletionFeedback(currentExercise);

            // Check if current exercise is completed
            if (currentExercise.currentSet >= currentExercise.totalSets) {
                currentExercise.completed = true;
                showNotification(`Упражнение "${currentExercise.name}" завершено!`, 'success');
                
                // Check if ALL exercises are completed
                if (isWorkoutComplete()) {
                    finishWorkout();
                    return;
                }
                
                // Move to next exercise if not all completed
                let nextExerciseIndex = -1;
                for (let i = AppState.currentExercise + 1; i < AppState.exercises.length; i++) {
                    if (!AppState.exercises[i].completed) {
                        nextExerciseIndex = i;
                        break;
                    }
                }
                
                if (nextExerciseIndex !== -1) {
                    AppState.currentExercise = nextExerciseIndex;
                }
            }

            // Start rest timer only if workout is not complete and not the last set
            if (!isWorkoutComplete() && currentExercise.currentSet < currentExercise.totalSets) {
                const restTime = AppState.timerSettings[currentExercise.type] || currentExercise.restTime;
                startRestTimer(restTime);
            }

            // Update UI
            renderExercises();
            updateProgress();
            updateStats();
            
            // Save progress
            saveWorkoutProgress();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            
            // Определяем цвет по типу уведомления
            let backgroundColor;
            switch(type) {
                case 'success': backgroundColor = 'var(--success)'; break;
                case 'warning': backgroundColor = 'var(--warning)'; break;
                case 'error': backgroundColor = 'var(--error)'; break;
                default: backgroundColor = 'var(--primary)';
            }
            
            notification.style.cssText = `
                position: fixed;
                top: 120px;
                left: 50%;
                transform: translateX(-50%);
                background: ${backgroundColor};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1002;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                max-width: 320px;
                text-align: center;
                animation: slideDown 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 2500);
        }

        function saveWorkoutProgress() {
            const progress = {
                date: new Date().toISOString(),
                currentExercise: AppState.currentExercise,
                completedSets: AppState.completedSets,
                exercises: AppState.exercises.map(ex => ({
                    name: ex.name,
                    currentSet: ex.currentSet,
                    completed: ex.completed
                })),
                workoutStartTime: AppState.workoutStartTime?.toISOString(),
                workoutDay: AppState.currentWorkoutDay.toISOString()
            };
            
            localStorage.setItem('fitnessProCurrentWorkout', JSON.stringify(progress));
        }

        function loadWorkoutProgress() {
            const saved = localStorage.getItem('fitnessProCurrentWorkout');
            if (saved) {
                const progress = JSON.parse(saved);
                const savedDate = new Date(progress.workoutDay);
                const today = new Date();
                
                // Only restore if it's the same day
                if (savedDate.toDateString() === today.toDateString()) {
                    AppState.currentExercise = progress.currentExercise || 0;
                    AppState.completedSets = progress.completedSets || 0;
                    
                    if (progress.workoutStartTime) {
                        AppState.workoutStartTime = new Date(progress.workoutStartTime);
                    }
                    
                    // Restore exercise progress
                    if (progress.exercises && AppState.exercises.length === progress.exercises.length) {
                        AppState.exercises.forEach((exercise, index) => {
                            if (progress.exercises[index]) {
                                exercise.currentSet = progress.exercises[index].currentSet || 0;
                                exercise.completed = progress.exercises[index].completed || false;
                            }
                        });
                    }
                    
                    showNotification('Прогресс тренировки восстановлен', 'success');
                }
            }
        }

        function showSetCompletionFeedback(exercise) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--success);
                color: white;
                padding: 20px 30px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1001;
                box-shadow: 0 8px 32px rgba(52, 199, 89, 0.3);
            `;
            
            feedback.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 8px;"><polyline points="20,6 9,17 4,12"/></svg> ${exercise.name} - ${exercise.currentSet}/${exercise.totalSets}`;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1500);
        }

        // Initialize Application
        function initApp() {
            AppState.workoutStartTime = new Date();
            
            // Load saved progress first
            loadWorkoutProgress();
            
            // Load achievements
            loadAchievements();
            
            // Track daily app usage for achievements
            const today = new Date().toDateString();
            const lastUsage = localStorage.getItem('lastAppUsage');
            if (lastUsage !== today) {
                updateAchievementStats('app_usage_day', 1);
                localStorage.setItem('lastAppUsage', today);
            }
            
            renderExercises();
            startWorkoutTimer();
            updateProgress();
            updateDateDisplay();
            
            // Load saved user preferences
            loadUserPreferences();
            
            // Add CSS animations
            addCustomStyles();
        }

        function addCustomStyles() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from {
                        transform: translateX(-50%) translateY(-30px);
                        opacity: 0;
                        scale: 0.95;
                    }
                    to {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                        scale: 1;
                    }
                }
                
                @keyframes slideUp {
                    from {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                        scale: 1;
                    }
                    to {
                        transform: translateX(-50%) translateY(-30px);
                        opacity: 0;
                        scale: 0.95;
                    }
                }

                @keyframes achievementSlide {
                    0% {
                        transform: translateX(-50%) translateY(-60px) scale(0.8);
                        opacity: 0;
                    }
                    60% {
                        transform: translateX(-50%) translateY(10px) scale(1.05);
                        opacity: 1;
                    }
                    100% {
                        transform: translateX(-50%) translateY(0) scale(1);
                        opacity: 1;
                    }
                }

                @keyframes achievementSlideOut {
                    from {
                        transform: translateX(-50%) translateY(0) scale(1);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(-50%) translateY(-60px) scale(0.8);
                        opacity: 0;
                    }
                }

                @keyframes breathe {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                }

                @keyframes sparkle {
                    0%, 100% { opacity: 0; transform: scale(0); }
                    50% { opacity: 1; transform: scale(1); }
                }

                @keyframes glow {
                    0%, 100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
                    50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.6); }
                }
                
                .progress-fill {
                    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background 0.4s ease;
                    position: relative;
                }

                .progress-fill::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    right: 0;
                    width: 8px;
                    height: 100%;
                    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.6) 100%);
                    animation: sparkle 1.5s ease-in-out infinite;
                }
                
                .exercise-item {
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                }

                .session-card:hover {
                    animation: breathe 3s ease-in-out infinite;
                }

                .nav-item:active {
                    transform: scale(0.95);
                }

                .btn:active {
                    transform: scale(0.98) translateY(1px);
                }

                .timer-btn:active {
                    transform: scale(0.95);
                }

                .achievement-unlocked {
                    animation: glow 2s ease-in-out infinite;
                }

                .achievement-rarity-common { border-left: 4px solid #34C759; }
                .achievement-rarity-rare { border-left: 4px solid #007AFF; }
                .achievement-rarity-epic { border-left: 4px solid #AF52DE; }
                .achievement-rarity-legendary { border-left: 4px solid #FFD700; }
            `;
            document.head.appendChild(style);
        }

        function loadUserPreferences() {
            const saved = localStorage.getItem('fitnessProPreferences');
            if (saved) {
                const prefs = JSON.parse(saved);
                AppState.user = { ...AppState.user, ...prefs.user };
                AppState.timerSettings = { ...AppState.timerSettings, ...prefs.timerSettings };
                updateUserInfo();
            }
        }

        function saveUserPreferences() {
            const prefs = {
                user: AppState.user,
                timerSettings: AppState.timerSettings
            };
            localStorage.setItem('fitnessProPreferences', JSON.stringify(prefs));
        }

        // Render Exercise List
        function renderExercises() {
            const exerciseList = document.getElementById('exerciseList');
            exerciseList.innerHTML = '';

            AppState.exercises.forEach((exercise, index) => {
                const exerciseItem = document.createElement('div');
                exerciseItem.className = 'exercise-item';
                
                if (exercise.completed) {
                    exerciseItem.classList.add('completed');
                } else if (index === AppState.currentExercise) {
                    exerciseItem.classList.add('active');
                }

                const status = exercise.completed ? 'Выполнено' : 
                              index === AppState.currentExercise ? `${exercise.currentSet}/${exercise.totalSets}` : 'Ожидание';

                exerciseItem.innerHTML = `
                    <div class="exercise-number">${index + 1}</div>
                    <div class="exercise-details">
                        <div class="exercise-name">${exercise.name}</div>
                        <div class="exercise-sets">${exercise.sets} • ${exercise.weight}</div>
                    </div>
                    <div class="exercise-actions">
                        <button onclick="showExerciseInstructions('${exercise.name}')" style="
                            background: var(--primary);
                            border: none;
                            border-radius: 6px;
                            padding: 6px 8px;
                            color: white;
                            font-size: 10px;
                            cursor: pointer;
                            margin-right: 8px;
                        ">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9,9h0a3,3,0,0,1,5.12-2.12A3,3,0,0,1,15,9.34V9a1,1,0,0,1-1,1H10a1,1,0,0,1-1-1Z"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                        </button>
                        <div class="exercise-status" style="font-size: 12px; color: var(--text-secondary);">${status}</div>
                    </div>
                `;

                exerciseList.appendChild(exerciseItem);
            });
        }

        // Start Rest Timer
        function startRestTimer(duration) {
            AppState.timer.timeLeft = duration;
            AppState.timer.isRunning = true;
            
            document.getElementById('timerSection').classList.add('active');
            updateTimerDisplay();
            
            AppState.timer.interval = setInterval(() => {
                AppState.timer.timeLeft--;
                updateTimerDisplay();
                
                if (AppState.timer.timeLeft <= 0) {
                    stopTimer();
                    document.getElementById('timerSection').classList.remove('active');
                    vibrate();
                }
            }, 1000);
        }

        // Timer Controls
        function toggleTimer() {
            if (AppState.timer.isRunning) {
                stopTimer();
            } else {
                startRestTimer(AppState.timer.timeLeft);
            }
        }

        function stopTimer() {
            AppState.timer.isRunning = false;
            clearInterval(AppState.timer.interval);
            AppState.timer.interval = null; // Предотвращаем утечки памяти
            const timerBtn = document.getElementById('timerBtn');
            if (timerBtn) {
                timerBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>';
            }
        }

        function adjustTimer(seconds) {
            AppState.timer.timeLeft = Math.max(0, AppState.timer.timeLeft + seconds);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(AppState.timer.timeLeft / 60);
            const seconds = AppState.timer.timeLeft % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerTime').textContent = timeString;
            document.getElementById('restTime').textContent = timeString;
            document.getElementById('timerBtn').innerHTML = AppState.timer.isRunning ? 
                '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>' : 
                '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>';
        }

        // Update Progress
        function updateProgress() {
            const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
            const progress = totalSets > 0 ? (AppState.completedSets / totalSets) * 100 : 0;
            
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = `${Math.min(100, Math.max(0, progress))}%`;
                
                // Add color based on progress
                if (progress < 25) {
                    progressFill.style.background = 'var(--error)';
                } else if (progress < 50) {
                    progressFill.style.background = 'var(--warning)';
                } else if (progress < 75) {
                    progressFill.style.background = 'var(--primary)';
                } else {
                    progressFill.style.background = 'var(--success)';
                }
            }
            
            // Update progress text
            updateProgressText(progress);
        }

        function updateProgressText(progress) {
            const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
            const completedExercises = AppState.exercises.filter(ex => ex.completed).length;
            const totalExercises = AppState.exercises.length;
            
            // Update main stats
            const completedSetsEl = document.getElementById('completedSets');
            if (completedSetsEl) {
                completedSetsEl.textContent = AppState.completedSets;
            }
            
            // Add progress indicator to session card if needed
            const sessionCard = document.querySelector('.session-card');
            let progressIndicator = sessionCard.querySelector('.progress-indicator');
            
            if (!progressIndicator && progress > 0) {
                progressIndicator = document.createElement('div');
                progressIndicator.className = 'progress-indicator';
                progressIndicator.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: ${progress}%;
                    height: 4px;
                    background: rgba(255, 255, 255, 0.3);
                    transition: width 0.3s ease;
                `;
                sessionCard.style.position = 'relative';
                sessionCard.appendChild(progressIndicator);
            } else if (progressIndicator) {
                progressIndicator.style.width = `${progress}%`;
            }
        }

        // Update Stats
        function updateStats() {
            document.getElementById('completedSets').textContent = AppState.completedSets;
        }

        // Workout Timer
        function startWorkoutTimer() {
            setInterval(() => {
                if (AppState.workoutStartTime) {
                    const elapsed = new Date() - AppState.workoutStartTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    document.getElementById('elapsedTime').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Pause Workout
        function pauseWorkout() {
            if (AppState.timer.isRunning) {
                stopTimer();
            }
            
            // Toggle workout pause state
            if (!AppState.isPaused) {
                AppState.isPaused = true;
                AppState.pauseStartTime = new Date();
                document.querySelector('.btn-secondary span:last-child').textContent = 'Продолжить';
                document.querySelector('.btn-secondary span:first-child').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>';
                
                // Show pause overlay
                showPauseOverlay();
            } else {
                AppState.isPaused = false;
            // Add pause time to workout start time
            if (AppState.pauseStartTime) {
                const pauseDuration = new Date() - AppState.pauseStartTime;
                AppState.workoutStartTime = new Date(AppState.workoutStartTime.getTime() + pauseDuration);
                AppState.pauseStartTime = null; // Очищаем после использования
            }
                document.querySelector('.btn-secondary span:last-child').textContent = 'Пауза';
                document.querySelector('.btn-secondary span:first-child').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>';
                
                // Hide pause overlay
                hidePauseOverlay();
            }
        }

        function showPauseOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'pauseOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 100%;
                max-width: 428px;
                height: 100vh;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 999;
                color: white;
                text-align: center;
            `;
            
            overlay.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                </div>
                <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">Тренировка на паузе</h2>
                <p style="color: var(--text-secondary); margin-bottom: 32px;">Нажмите "Продолжить" для возобновления</p>
                <button onclick="pauseWorkout()" style="
                    padding: 16px 32px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: 12px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                ">Продолжить тренировку</button>
            `;
            
            document.body.appendChild(overlay);
        }

        function hidePauseOverlay() {
            const overlay = document.getElementById('pauseOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Settings Functions
        function adjustWeight(delta) {
            const oldWeight = AppState.user.weight;
            AppState.user.weight = Math.max(30, Math.min(200, AppState.user.weight + delta));
            document.getElementById('weightDisplay').textContent = AppState.user.weight;
            updateBMI();
            updateUserInfo();
            saveUserPreferences();
            
            if (oldWeight !== AppState.user.weight) {
                showNotification(`Вес изменен на ${AppState.user.weight} кг`, 'info');
            }
        }

        function adjustHeight(delta) {
            const oldHeight = AppState.user.height;
            AppState.user.height = Math.max(100, Math.min(220, AppState.user.height + delta));
            document.getElementById('heightDisplay').textContent = AppState.user.height;
            updateBMI();
            updateUserInfo();
            saveUserPreferences();
            
            if (oldHeight !== AppState.user.height) {
                showNotification(`Рост изменен на ${AppState.user.height} см`, 'info');
            }
        }

        function updateBMI() {
            const bmi = (AppState.user.weight / Math.pow(AppState.user.height / 100, 2)).toFixed(1);
            const bmiElement = document.getElementById('bmiDisplay');
            if (bmiElement) {
                bmiElement.textContent = bmi;
                
                // Update BMI color based on range
                if (bmi < 18.5) {
                    bmiElement.style.color = 'var(--warning)';
                } else if (bmi >= 18.5 && bmi < 25) {
                    bmiElement.style.color = 'var(--success)';
                } else if (bmi >= 25 && bmi < 30) {
                    bmiElement.style.color = 'var(--warning)';
                } else {
                    bmiElement.style.color = 'var(--error)';
                }
            }
        }

        function updateUserInfo() {
            document.querySelector('.user-info').textContent = `${AppState.user.weight}кг • ${AppState.user.height}см`;
        }

        function adjustTimerSetting(type, delta) {
            const settings = AppState.timerSettings;
            const oldValue = settings[type];
            settings[type] = Math.max(30, settings[type] + delta);
            
            const displayId = type === 'heavy' ? 'heavyTimerDisplay' : 
                             type === 'medium' ? 'mediumTimerDisplay' : 'lightTimerDisplay';
            const element = document.getElementById(displayId);
            if (element) {
                const minutes = Math.floor(settings[type] / 60);
                const seconds = settings[type] % 60;
                element.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            saveUserPreferences();
            
            // Show notification about the change
            if (oldValue !== settings[type]) {
                const typeNames = { heavy: 'базовых', medium: 'средних', light: 'изоляционных' };
                const minutes = Math.floor(settings[type] / 60);
                const seconds = settings[type] % 60;
                const timeText = seconds > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${minutes} мин`;
                showNotification(`Время отдыха для ${typeNames[type]} упражнений: ${timeText}`, 'info');
            }
        }

        function resetWorkout() {
            if (confirm('Вы уверены, что хотите сбросить текущую тренировку? Весь прогресс будет потерян.')) {
                // Save partial workout to history if there was progress
                if (AppState.completedSets > 0) {
                    const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
                    const workoutDuration = Math.floor((new Date() - AppState.workoutStartTime) / 60000);
                    const sessionTypeEl = document.getElementById('sessionType');
                    
                    const partialWorkout = {
                        date: new Date().toISOString(),
                        type: sessionTypeEl ? sessionTypeEl.textContent : 'Incomplete',
                        duration: workoutDuration,
                        exercises: AppState.exercises.length,
                        sets: AppState.completedSets,
                        totalSets: totalSets,
                        completed: false,
                        progress: Math.round((AppState.completedSets / totalSets) * 100),
                        calories: Math.round(workoutDuration * 8 + AppState.completedSets * 15)
                    };
                    
                    let history = JSON.parse(localStorage.getItem('fitnessProHistory') || '[]');
                    history.unshift(partialWorkout);
                    history = history.slice(0, 20);
                    localStorage.setItem('fitnessProHistory', JSON.stringify(history));
                }
                
                // Reset all state
                AppState.currentExercise = 0;
                AppState.completedSets = 0;
                AppState.workoutStartTime = new Date();
                AppState.isPaused = false;
                
                // Reset exercises
                AppState.exercises.forEach(exercise => {
                    exercise.completed = false;
                    exercise.currentSet = 0;
                });
                
                // Stop timer
                stopTimer();
                document.getElementById('timerSection').classList.remove('active');
                
                // Hide pause overlay if active
                hidePauseOverlay();
                
                // Clear saved progress
                localStorage.removeItem('fitnessProCurrentWorkout');
                
                // Update UI
                renderExercises();
                updateProgress();
                updateStats();
                
                closeModal();
                showNotification('Тренировка сброшена', 'success');
            }
        }

        function exportData() {
            const workoutData = {
                date: new Date().toISOString(),
                user: AppState.user,
                exercises: AppState.exercises,
                completedSets: AppState.completedSets,
                workoutDuration: AppState.workoutStartTime ? 
                    Math.floor((new Date() - AppState.workoutStartTime) / 60000) : 0,
                progress: Math.round((AppState.completedSets / 
                    AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0)) * 100)
            };
            
            const dataStr = JSON.stringify(workoutData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `fitness-pro-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function jumpToExercise(index) {
            if (index >= 0 && index < AppState.exercises.length && !AppState.exercises[index].completed) {
                AppState.currentExercise = index;
                renderExercises();
                updateProgress();
            }
        }

        // Finish Workout
        function finishWorkout() {
            stopTimer();
            document.getElementById('timerSection').classList.remove('active');
            
            const workoutDuration = Math.floor((new Date() - AppState.workoutStartTime) / 60000);
            const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
            
            // Update achievement stats for completed workout
            updateAchievementStats('workout_completed', 1);
            updateAchievementStats('time_spent', workoutDuration);
            updateAchievementStats('longest_workout', workoutDuration);
            
            // Check for high volume session (>20 sets)
            if (totalSets > 20) {
                updateAchievementStats('high_volume_session', 1);
            }
            
            // Check for short rest workouts (average rest < 60 seconds)
            const totalRestTime = AppState.exercises.reduce((sum, ex) => sum + (ex.restTime || 90), 0);
            const avgRestTime = totalRestTime / AppState.exercises.length;
            if (avgRestTime < 60) {
                updateAchievementStats('short_rest_workout', 1);
            }
            
            // Track exercise specific achievements
            AppState.exercises.forEach(exercise => {
                updateAchievementStats('exercise_specific', exercise.name);
            });
            
            // Calculate calories burned
            const caloriesBurned = Math.round(workoutDuration * 8 + AppState.completedSets * 15);
            updateAchievementStats('calories_burned', caloriesBurned);
            
            // Check if perfect workout (100% completion)
            if (AppState.completedSets === totalSets) {
                updateAchievementStats('perfect_workout', 1);
            } else {
                updateAchievementStats('imperfect_workout', 1);
            }
            
            // Update workout type stats
            const sessionTypeEl = document.getElementById('sessionType');
            if (sessionTypeEl) {
                const workoutType = sessionTypeEl.textContent.toLowerCase();
                if (workoutType === 'push') {
                    updateAchievementStats('push_workout', 1);
                } else if (workoutType === 'pull') {
                    updateAchievementStats('pull_workout', 1);
                } else if (workoutType === 'legs') {
                    updateAchievementStats('leg_workout', 1);
                }
            }
            
            // Update daily app usage
            updateAchievementStats('app_usage_day', 1);
            
            // Create completion overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 100%;
                max-width: 428px;
                height: 100vh;
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 999;
                color: white;
                text-align: center;
                padding: 40px;
            `;
            
            overlay.innerHTML = `
                <div style="margin-bottom: 24px;">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
                        <circle cx="12" cy="8" r="7"/>
                        <polyline points="8.21,13.89 7,23 12,20 17,23 15.79,13.88"/>
                    </svg>
                </div>
                <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 12px;">Тренировка завершена!</h2>
                <p style="font-size: 16px; opacity: 0.9; margin-bottom: 32px;">Отличная работа! Вы выполнили все упражнения.</p>
                
                <div style="background: rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 24px; margin-bottom: 32px; width: 100%;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">${workoutDuration}</div>
                            <div style="font-size: 12px; opacity: 0.8;">Минут</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">${totalSets}</div>
                            <div style="font-size: 12px; opacity: 0.8;">Подходов</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">${AppState.exercises.length}</div>
                            <div style="font-size: 12px; opacity: 0.8;">Упражнений</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 16px; width: 100%;">
                    <button onclick="this.parentElement.parentElement.remove(); resetWorkout();" style="
                        flex: 1;
                        padding: 16px;
                        background: rgba(255, 255, 255, 0.2);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Новая тренировка</button>
                    <button onclick="this.parentElement.parentElement.remove();" style="
                        flex: 1;
                        padding: 16px;
                        background: white;
                        color: var(--primary);
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Готово</button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Save workout to history
            saveWorkoutToHistory();
        }

        function saveWorkoutToHistory() {
            const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
            const workoutDuration = Math.floor((new Date() - AppState.workoutStartTime) / 60000);
            
            // Get current workout type
            const sessionTypeEl = document.getElementById('sessionType');
            const currentWorkoutType = sessionTypeEl ? sessionTypeEl.textContent : 'Workout';
            
            const workout = {
                date: new Date().toISOString(),
                type: currentWorkoutType,
                duration: workoutDuration,
                exercises: AppState.exercises.length,
                sets: AppState.completedSets,
                totalSets: totalSets,
                completed: AppState.completedSets === totalSets,
                progress: Math.round((AppState.completedSets / totalSets) * 100),
                calories: Math.round(workoutDuration * 8 + AppState.completedSets * 15)
            };
            
            let history = JSON.parse(localStorage.getItem('fitnessProHistory') || '[]');
            history.unshift(workout);
            history = history.slice(0, 20); // Keep last 20 workouts
            localStorage.setItem('fitnessProHistory', JSON.stringify(history));
            
            // Clear current workout progress
            localStorage.removeItem('fitnessProCurrentWorkout');
        }

        // Modal Functions
        function openModal(type) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            switch(type) {
                case 'stats':
                    title.textContent = 'Статистика и аналитика';
                    content.innerHTML = renderStatsModal();
                    break;
                case 'progress':
                    title.textContent = 'Прогресс тренировок';
                    content.innerHTML = renderProgressModal();
                    break;
                case 'achievements':
                    title.textContent = 'Достижения';
                    content.innerHTML = renderAchievementsModal();
                    break;
                case 'settings':
                    title.textContent = 'Настройки';
                    content.innerHTML = renderSettingsModal();
                    // Update current values in settings
                    updateSettingsDisplay();
                    break;
            }
            
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Exercise Instructions Modal
        function showExerciseInstructions(exerciseName) {
            const instruction = EXERCISE_INSTRUCTIONS[exerciseName];
            if (!instruction) {
                showNotification('Инструкция для этого упражнения пока недоступна', 'warning');
                return;
            }

            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = exerciseName;
            
            content.innerHTML = `
                <div style="margin-bottom: 24px;">
                    <!-- Description -->
                    <div style="background: var(--surface); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 8px 0; color: var(--primary);">Описание</h4>
                        <p style="margin: 0; color: var(--text-secondary);">${instruction.description}</p>
                    </div>
                    
                    <!-- Target Muscles -->
                    <div style="background: var(--surface); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 12px 0; color: var(--primary);">Работающие мышцы</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${instruction.muscles.map(muscle => `
                                <span style="
                                    background: var(--primary);
                                    color: white;
                                    padding: 4px 12px;
                                    border-radius: 16px;
                                    font-size: 12px;
                                    font-weight: 600;
                                ">${muscle}</span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div style="background: var(--surface); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 12px 0; color: var(--primary);">Техника выполнения</h4>
                        <ol style="margin: 0; padding-left: 20px; color: var(--text-primary);">
                            ${instruction.instructions.map(step => `<li style="margin-bottom: 8px;">${step}</li>`).join('')}
                        </ol>
                    </div>
                    
                    <!-- Tips -->
                    <div style="background: linear-gradient(135deg, var(--warning) 0%, #ffa500 100%); padding: 16px; border-radius: 12px; color: white;">
                        <h4 style="margin: 0 0 12px 0; display: flex; align-items: center; gap: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3 8-8"/>
                                <path d="M21 12c0 5-4 9-9 9s-9-4-9-9"/>
                                <path d="M3.5 8.5l4.5 4.5"/>
                            </svg>
                            Полезные советы
                        </h4>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${instruction.tips.map(tip => `<li style="margin-bottom: 6px;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Vibration for mobile devices
        function vibrate() {
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        // Validate user data
        function validateUserData() {
            if (AppState.user.weight < 30 || AppState.user.weight > 200) {
                AppState.user.weight = 75;
            }
            if (AppState.user.height < 100 || AppState.user.height > 220) {
                AppState.user.height = 170;
            }
        }

        // Error handling wrapper
        function safeExecute(fn, fallback = () => {}) {
            try {
                return fn();
            } catch (error) {
                console.error('Error executing function:', error);
                showNotification('Произошла ошибка', 'error');
                return fallback();
            }
        }

        // Render Exercises Modal
        function getWorkoutEmoji(type) {
            switch(type) {
                case 'PUSH': return '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 22L12 18.27L5.82 22L7 14L2 9L8.91 8.26L12 2Z" fill="#FF6B35"/></svg>';
                case 'PULL': return '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z" fill="#34C759"/><path d="M8 22H16V13H14V11H16C17.1 11 18 11.9 18 13V22H20V13C20 10.8 18.2 9 16 9H14V7C14 6.4 13.6 6 13 6H11C10.4 6 10 6.4 10 7V9H8C5.8 9 4 10.8 4 13V22H6V13C6 11.9 6.9 11 8 11H10V13H8V22Z" fill="#34C759"/></svg>';
                case 'LEGS': return '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 2H16V8H14V22H10V8H8V2Z" fill="#FF9F0A"/></svg>';
                default: return '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 22L12 18.27L5.82 22L7 14L2 9L8.91 8.26L12 2Z" fill="#0066CC"/></svg>';
            }
        }

        function renderStatsModal() {
            const history = JSON.parse(localStorage.getItem('fitnessProHistory') || '[]');
            const stats = AppState.achievements.stats;
            const totalWorkouts = stats.totalWorkouts || history.length;
            const completedWorkouts = history.filter(w => w.completed).length;
            const totalSets = stats.totalSets || history.reduce((sum, w) => sum + (w.sets || 0), 0);
            const totalTime = stats.totalTime || history.reduce((sum, w) => sum + (w.duration || 0), 0);
            const avgDuration = totalWorkouts > 0 ? Math.round(totalTime / totalWorkouts) : 0;
            const totalAchievements = AppState.achievements.unlocked.length;
            const totalPossibleAchievements = Object.keys(ACHIEVEMENTS).length;
            
            // Current week progress
            const now = new Date();
            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            const thisWeekWorkouts = history.filter(w => {
                const workoutDate = new Date(w.date);
                return workoutDate >= weekStart;
            });
            
            const workoutTypes = {
                PUSH: stats.pushExercises || 0,
                PULL: stats.pullExercises || 0,
                LEGS: stats.legExercises || 0
            };
            
            let typeStatsHtml = '';
            const icons = {
                PUSH: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="3" y="7" width="14" height="6" rx="2" fill="#FF6B35"/><rect x="7" y="3" width="6" height="14" rx="2" fill="#FF6B35"/></svg>',
                PULL: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="3" y="7" width="14" height="6" rx="2" fill="#34C759"/><rect x="7" y="3" width="6" height="14" rx="2" fill="#34C759" transform="rotate(180 10 10)"/></svg>',
                LEGS: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="8" y="3" width="4" height="14" rx="2" fill="#FF9F0A"/></svg>'
            };
            
            Object.entries(workoutTypes).forEach(([type, count]) => {
                const percentage = totalWorkouts > 0 ? Math.round((count / totalWorkouts) * 100) : 0;
                typeStatsHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="display: flex; align-items: center; gap: 8px;">
                            <span>${icons[type]}</span>
                            <span>${type}</span>
                        </span>
                        <span style="font-weight: 600;">${count} (${percentage}%)</span>
                    </div>
                `;
            });
            
            return `
                <div style="margin-bottom: 24px;">
                    <h4 style="margin-bottom: 16px;">Общая статистика</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="margin-bottom: 8px;"> <svg width="28" height="28" viewBox="0 0 20 20" fill="none"><rect x="3" y="7" width="14" height="6" rx="2" fill="#FF6B35"/><rect x="7" y="3" width="6" height="14" rx="2" fill="#FF6B35"/></svg> </div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 4px;">${totalWorkouts}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Всего тренировок</div>
                        </div>
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="margin-bottom: 8px;"> <svg width="28" height="28" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="8" fill="#34C759"/></svg> </div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--success); margin-bottom: 4px;">${completedWorkouts}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Завершено</div>
                        </div>
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="margin-bottom: 8px;"> <svg width="28" height="28" viewBox="0 0 20 20" fill="none"><rect x="8" y="3" width="4" height="14" rx="2" fill="#FF9F0A"/></svg> </div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--warning); margin-bottom: 4px;">${totalSets}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Всего подходов</div>
                        </div>
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="margin-bottom: 8px;"> <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z" fill="#FFD700"/></svg> </div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 4px;">${totalAchievements}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Достижений</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--surface); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 12px;">Прогресс достижений</h5>
                        <div style="background: var(--bg-secondary); border-radius: 8px; height: 8px; margin-bottom: 8px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #FFD700, #FFA500); height: 100%; width: ${(totalAchievements / totalPossibleAchievements * 100)}%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary);">
                            <span>${totalAchievements}/${totalPossibleAchievements} разблокировано</span>
                            <span>${Math.round(totalAchievements / totalPossibleAchievements * 100)}%</span>
                        </div>
                    </div>
                    
                    <div style="background: var(--surface); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 12px;">Распределение тренировок</h5>
                        ${typeStatsHtml}
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button onclick="openModal('achievements')" style="
                            flex: 1;
                            padding: 12px 16px;
                            background: linear-gradient(135deg, #FFD700, #FFA500);
                            color: #2D3748;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                                <path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z"/>
                            </svg>
                            Достижения
                        </button>
                    </div>
                </div>
            `;
        }

        // Render Progress Modal
        function renderProgressModal() {
            const totalSets = AppState.exercises.reduce((sum, ex) => sum + ex.totalSets, 0);
            const completedPercentage = totalSets > 0 ? Math.round((AppState.completedSets / totalSets) * 100) : 0;
            const workoutTime = AppState.workoutStartTime ? 
                Math.floor((new Date() - AppState.workoutStartTime) / 60000) : 0;
            
            const completedExercises = AppState.exercises.filter(ex => ex.completed).length;
            const totalExercises = AppState.exercises.length;
            
            // Calculate average rest time based on completed sets
            let averageRestTime = 120; // default
            if (AppState.completedSets > 0) {
                const totalRestTime = AppState.exercises.reduce((sum, ex) => {
                    return sum + (ex.currentSet * ex.restTime);
                }, 0);
                averageRestTime = Math.round(totalRestTime / AppState.completedSets);
            }
            
            // Get workout history from localStorage
            const history = JSON.parse(localStorage.getItem('fitnessProHistory') || '[]');
            
            // Calculate calories (rough estimate)
            const estimatedCalories = Math.round(workoutTime * 8 + AppState.completedSets * 15);
            
            let historyHtml = '';
            if (history.length > 0) {
                historyHtml = history.slice(0, 5).map(workout => {
                    const workoutDate = new Date(workout.date);
                    const dateStr = workoutDate.toLocaleDateString('ru-RU', { 
                        day: 'numeric', 
                        month: 'long',
                        year: 'numeric'
                    });
                    
                    const completionColor = workout.completed ? 'var(--success)' : 'var(--warning)';
                    const completionText = workout.completed ? '100%' : `${workout.progress || 0}%`;
                    
                    return `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border);">
                            <span style="font-size: 20px;">${getWorkoutEmoji(workout.type)}</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${workout.type}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">${dateStr} • ${workout.duration} мин</div>
                            </div>
                            <div style="color: ${completionColor}; font-weight: 600;">${completionText}</div>
                        </div>
                    `;
                }).join('');
            } else {
                historyHtml = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 12px;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M3 3v18h18"/>
                                <path d="M7 16L12 11L16 15L21 10"/>
                                <circle cx="12" cy="11" r="1"/>
                                <circle cx="16" cy="15" r="1"/>
                                <circle cx="7" cy="16" r="1"/>
                                <circle cx="21" cy="10" r="1"/>
                            </svg>
                        </div>
                        <p>История тренировок пуста</p>
                        <p style="font-size: 12px; margin-top: 4px;">Завершите первую тренировку для отображения статистики</p>
                    </div>
                `;
            }
            
            return `
                <div style="margin-bottom: 24px;">
                    <h4 style="margin-bottom: 16px; font-size: 18px;">Текущая тренировка</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 4px;">${completedPercentage}%</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Выполнено</div>
                        </div>
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success); margin-bottom: 4px;">${workoutTime}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Минут</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--warning); margin-bottom: 4px;">${estimatedCalories}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Калорий</div>
                        </div>
                        <div style="background: var(--surface); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 4px;">${AppState.currentExercise + 1}/${totalExercises}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Упражнение</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--surface); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 12px;">Детальная статистика</h5>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Подходы выполнено:</span>
                            <span style="font-weight: 600;">${AppState.completedSets} из ${totalSets}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Упражнения выполнено:</span>
                            <span style="font-weight: 600;">${completedExercises} из ${totalExercises}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Среднее время отдыха:</span>
                            <span style="font-weight: 600;">${Math.floor(averageRestTime / 60)}:${(averageRestTime % 60).toString().padStart(2, '0')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Темп тренировки:</span>
                            <span style="font-weight: 600;">${workoutTime > 0 ? Math.round(AppState.completedSets / (workoutTime / 60)) : 0} подх/час</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Оставшееся время:</span>
                            <span style="font-weight: 600; color: var(--warning);">${Math.max(0, 120 - workoutTime)} мин</span>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 16px;">История тренировок</h4>
                <div style="background: var(--surface); border-radius: 12px; padding: 16px;">
                    ${historyHtml}
                </div>
            `;
        }

        function getWorkoutEmoji(workoutType) {
            const emojis = {
                'Push Day': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 22L12 18.27L5.82 22L7 14L2 9L8.91 8.26L12 2Z" fill="#FF6B35"/></svg>',
                'Pull Day': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z" fill="#34C759"/><path d="M8 22H16V13H14V11H16C17.1 11 18 11.9 18 13V22H20V13C20 10.8 18.2 9 16 9H14V7C14 6.4 13.6 6 13 6H11C10.4 6 10 6.4 10 7V9H8C5.8 9 4 10.8 4 13V22H6V13C6 11.9 6.9 11 8 11H10V13H8V22Z" fill="#34C759"/></svg>',
                'Leg Day': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M8 2H16V8H14V22H10V8H8V2Z" fill="#FF9F0A"/></svg>',
                'PUSH': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 22L12 18.27L5.82 22L7 14L2 9L8.91 8.26L12 2Z" fill="#FF6B35"/></svg>',
                'PULL': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z" fill="#34C759"/><path d="M8 22H16V13H14V11H16C17.1 11 18 11.9 18 13V22H20V13C20 10.8 18.2 9 16 9H14V7C14 6.4 13.6 6 13 6H11C10.4 6 10 6.4 10 7V9H8C5.8 9 4 10.8 4 13V22H6V13C6 11.9 6.9 11 8 11H10V13H8V22Z" fill="#34C759"/></svg>',
                'LEGS': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M8 2H16V8H14V22H10V8H8V2Z" fill="#FF9F0A"/></svg>',
                'REST': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#6B7280"/><path d="M9 10H7A5 5 0 0 0 7 20H9M15 10H17A5 5 0 0 1 17 20H15M8 18H16" stroke="white" stroke-width="1.5" fill="none"/></svg>'
            };
            return emojis[workoutType] || '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2L15.09 8.26L22 9L17 14L18.18 22L12 18.27L5.82 22L7 14L2 9L8.91 8.26L12 2Z" fill="#0066CC"/></svg>';
        }

        function renderAchievementsModal() {
            const unlockedAchievements = AppState.achievements.unlocked;
            const stats = AppState.achievements.stats;
            
            let achievementSections = {
                unlocked: [],
                locked: []
            };
            
            Object.values(ACHIEVEMENTS).forEach(achievement => {
                if (unlockedAchievements.includes(achievement.id)) {
                    achievementSections.unlocked.push(achievement);
                } else {
                    achievementSections.locked.push(achievement);
                }
            });
            
            // Sort achievements by rarity
            const rarityOrder = { legendary: 4, epic: 3, rare: 2, common: 1 };
            achievementSections.unlocked.sort((a, b) => (rarityOrder[b.rarity] || 0) - (rarityOrder[a.rarity] || 0));
            achievementSections.locked.sort((a, b) => (rarityOrder[b.rarity] || 0) - (rarityOrder[a.rarity] || 0));
            
            function renderAchievementItem(achievement, isUnlocked) {
                const rarityColors = {
                    common: '#34C759',
                    rare: '#007AFF',
                    epic: '#AF52DE',
                    legendary: '#FFD700'
                };
                
                const rarityNames = {
                    common: 'Обычное',
                    rare: 'Редкое',
                    epic: 'Эпическое',
                    legendary: 'Легендарное'
                };
                
                const progressText = getAchievementProgress(achievement, stats);
                
                return `
                    <div style="
                        background: var(--surface);
                        padding: 16px;
                        border-radius: 12px;
                        margin-bottom: 12px;
                        border-left: 4px solid ${rarityColors[achievement.rarity]};
                        opacity: ${isUnlocked ? '1' : '0.6'};
                        position: relative;
                        ${isUnlocked ? 'box-shadow: 0 4px 20px rgba(255, 215, 0, 0.1);' : ''}
                    ">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="
                                font-size: 32px;
                                ${isUnlocked ? '' : 'filter: grayscale(100%);'}
                            ">
                                ${isUnlocked ? achievement.svgIcon : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="#666" stroke-width="2"/><path d="M12 6v6l4 2" stroke="#666" stroke-width="2"/></svg>'}
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <h4 style="margin: 0; font-size: 16px; color: ${isUnlocked ? 'var(--text-primary)' : 'var(--text-secondary)'};">
                                        ${isUnlocked ? achievement.name : '🔒 Секретное достижение'}
                                    </h4>
                                    <span style="
                                        background: ${rarityColors[achievement.rarity]};
                                        color: white;
                                        padding: 2px 8px;
                                        border-radius: 12px;
                                        font-size: 10px;
                                        font-weight: 600;
                                        text-transform: uppercase;
                                    ">
                                        ${rarityNames[achievement.rarity]}
                                    </span>
                                </div>
                                <p style="margin: 0; font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                                    ${isUnlocked ? achievement.description : 'Достижение заблокировано'}
                                </p>
                                ${progressText ? `<div style="font-size: 12px; color: var(--primary); font-weight: 600;">${progressText}</div>` : ''}
                            </div>
                        </div>
                        ${isUnlocked ? `
                            <div style="
                                position: absolute;
                                top: 8px;
                                right: 8px;
                                background: linear-gradient(135deg, #FFD700, #FFA500);
                                color: #2D3748;
                                padding: 4px 8px;
                                border-radius: 12px;
                                font-size: 10px;
                                font-weight: 700;
                            ">
                                ✓ РАЗБЛОКИРОВАНО
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            const totalUnlocked = achievementSections.unlocked.length;
            const totalAchievements = Object.keys(ACHIEVEMENTS).length;
            const completionRate = Math.round((totalUnlocked / totalAchievements) * 100);
            
            return `
                <div style="margin-bottom: 24px;">
                    <!-- Progress Header -->
                    <div style="background: linear-gradient(135deg, #FFD700, #FFA500); padding: 20px; border-radius: 16px; margin-bottom: 24px; color: #2D3748;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z" fill="#2D3748"/>
                            </svg>
                            <div>
                                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">Прогресс достижений</h3>
                                <p style="margin: 0; font-size: 14px; opacity: 0.8;">${totalUnlocked} из ${totalAchievements} разблокировано</p>
                            </div>
                        </div>
                        <div style="background: rgba(45, 55, 72, 0.2); border-radius: 8px; height: 8px; margin-bottom: 8px; overflow: hidden;">
                            <div style="background: #2D3748; height: 100%; width: ${completionRate}%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="text-align: center; font-size: 24px; font-weight: 700;">${completionRate}%</div>
                    </div>
                    
                    <!-- Unlocked Achievements -->
                    ${totalUnlocked > 0 ? `
                        <div style="margin-bottom: 24px;">
                            <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2">
                                    <path d="M12 2l3.09 6.26L22 9l-5 4.74L18.18 21 12 17.77 5.82 21 7 13.74 2 9l6.91-.74L12 2z"/>
                                </svg>
                                Разблокированные достижения (${totalUnlocked})
                            </h4>
                            ${achievementSections.unlocked.map(achievement => renderAchievementItem(achievement, true)).join('')}
                        </div>
                    ` : ''}
                    
                    <!-- Locked Achievements -->
                    <div>
                        <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <circle cx="12" cy="16" r="1"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            Заблокированные достижения (${achievementSections.locked.length})
                        </h4>
                        ${achievementSections.locked.map(achievement => renderAchievementItem(achievement, false)).join('')}
                    </div>
                </div>
            `;
        }

        function getAchievementProgress(achievement, stats) {
            // Show progress for some achievements
            switch(achievement.id) {
                case 'SETS_BEGINNER':
                    return `Прогресс: ${stats.totalSets}/100 подходов`;
                case 'THOUSAND_SETS':
                    return `Прогресс: ${stats.totalSets}/1000 подходов`;
                case 'WORKOUT_WARRIOR':
                    return `Прогресс: ${stats.totalWorkouts}/10 тренировок`;
                case 'CENTURY_CLUB':
                    return `Прогресс: ${stats.totalWorkouts}/100 тренировок`;
                case 'HOUR_POWER':
                    return `Прогресс: ${stats.totalTime}/60 минут`;
                case 'MARATHON_TRAINER':
                    return `Прогресс: ${stats.totalTime}/1440 минут`;
                case 'CONSISTENCY_KING':
                    return `Лучшая серия: ${stats.maxStreak}/7 дней`;
                case 'IRON_WILL':
                    return `Лучшая серия: ${stats.maxStreak}/30 дней`;
                case 'PUSH_MASTER':
                    return `Прогресс: ${stats.pushExercises}/20 тренировок`;
                case 'PULL_CHAMPION':
                    return `Прогресс: ${stats.pullExercises}/20 тренировок`;
                case 'LEG_DESTROYER':
                    return `Прогресс: ${stats.legExercises}/15 тренировок`;
                case 'CALORIE_CRUSHER':
                    return `Прогресс: ${stats.totalCalories}/10000 калорий`;
                case 'HEAVY_LIFTER':
                    return `Прогресс: ${stats.heavySets}/200 подходов`;
                default:
                    return '';
            }
        }

        // Render Settings Modal
        function renderSettingsModal() {
            return `
                <div style="margin-bottom: 24px;">
                    <h4 style="margin-bottom: 16px;">Профиль</h4>
                    <div style="background: var(--surface); border-radius: 12px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <span style="color: var(--text-secondary);">Вес</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button onclick="adjustWeight(-1)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">-</button>
                                <span style="font-weight: 600; min-width: 40px; text-align: center;" id="weightDisplay">75</span>
                                <button onclick="adjustWeight(1)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">+</button>
                                <span style="color: var(--text-secondary); margin-left: 4px;">кг</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <span style="color: var(--text-secondary);">Рост</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button onclick="adjustHeight(-1)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">-</button>
                                <span style="font-weight: 600; min-width: 40px; text-align: center;" id="heightDisplay">170</span>
                                <button onclick="adjustHeight(1)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">+</button>
                                <span style="color: var(--text-secondary); margin-left: 4px;">см</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                            <span style="color: var(--text-secondary);">ИМТ</span>
                            <span style="font-weight: 600; color: var(--success);" id="bmiDisplay">25.9</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Время тренировок</span>
                            <span style="font-weight: 600;">10:00 - 12:00</span>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 16px;">Настройки таймера</h4>
                <div style="background: var(--surface); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <div style="background: var(--primary); background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="color: white; font-size: 12px; margin: 0; text-align: center;">
                            💡 Настройки таймера влияют на время отдыха между подходами в тренировке
                        </p>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <span style="color: var(--text-secondary);">Базовые упражнения</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button onclick="adjustTimerSetting('heavy', -30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">-</button>
                            <span style="font-weight: 600; min-width: 50px; text-align: center;" id="heavyTimerDisplay">3:00</span>
                            <button onclick="adjustTimerSetting('heavy', 30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">+</button>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <span style="color: var(--text-secondary);">Средние упражнения</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button onclick="adjustTimerSetting('medium', -30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">-</button>
                            <span style="font-weight: 600; min-width: 50px; text-align: center;" id="mediumTimerDisplay">2:00</span>
                            <button onclick="adjustTimerSetting('medium', 30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">+</button>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: var(--text-secondary);">Изоляционные</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button onclick="adjustTimerSetting('light', -30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">-</button>
                            <span style="font-weight: 600; min-width: 50px; text-align: center;" id="lightTimerDisplay">1:30</span>
                            <button onclick="adjustTimerSetting('light', 30)" style="width: 32px; height: 32px; border: none; background: var(--surface-light); color: var(--text-primary); border-radius: 6px; cursor: pointer;">+</button>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 16px;">Действия</h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="resetWorkout()" style="
                        width: 100%;
                        padding: 16px;
                        background: var(--warning);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Сбросить текущую тренировку</button>
                    <button onclick="exportData()" style="
                        width: 100%;
                        padding: 16px;
                        background: var(--surface-light);
                        color: var(--text-primary);
                        border: 1px solid var(--border);
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Экспорт данных</button>
                </div>
            `;
        }

        function updateSettingsDisplay() {
            // Update weight display
            const weightDisplay = document.getElementById('weightDisplay');
            if (weightDisplay) {
                weightDisplay.textContent = AppState.user.weight;
            }
            
            // Update height display
            const heightDisplay = document.getElementById('heightDisplay');
            if (heightDisplay) {
                heightDisplay.textContent = AppState.user.height;
            }
            
            // Update BMI
            updateBMI();
            
            // Update timer settings displays
            const heavyDisplay = document.getElementById('heavyTimerDisplay');
            if (heavyDisplay) {
                const minutes = Math.floor(AppState.timerSettings.heavy / 60);
                const seconds = AppState.timerSettings.heavy % 60;
                heavyDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            const mediumDisplay = document.getElementById('mediumTimerDisplay');
            if (mediumDisplay) {
                const minutes = Math.floor(AppState.timerSettings.medium / 60);
                const seconds = AppState.timerSettings.medium % 60;
                mediumDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            const lightDisplay = document.getElementById('lightTimerDisplay');
            if (lightDisplay) {
                const minutes = Math.floor(AppState.timerSettings.light / 60);
                const seconds = AppState.timerSettings.light % 60;
                lightDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Utility Functions
        function vibrate() {
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
